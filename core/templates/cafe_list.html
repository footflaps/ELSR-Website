{% extends "base.html" %}



{% block content %}

<!---------------------------------------------------------------------------------------------------->
<!--                                    Set up Google Maps                                          -->
<!---------------------------------------------------------------------------------------------------->

<head>
	<!-- Google Maps -->
	{{"decoupled-map"|googlemap_js(37.4419, -122.1419)}}
	{{cafemap.js}}
</head>


<!---------------------------------------------------------------------------------------------------->
<!--                                       Page Header                                              -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url({{ url_for('static', filename='img/cafe-bg.jpg')}})">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					<h1>The Cafes</h1>
					<span class="subheading">Our favourite spots</span>
				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}


<!---------------------------------------------------------------------------------------------------->
<!--                                       Map View of Cafes                                        -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
			
			<!-- Link to route planning guide -->
			<h2 class="text-center mt-5 mb-2">
				<a href="{{ url_for('plan') }}">
					<i class="fa-solid fa-triangle-exclamation fa-fade"></i>
					How to choose a suitable route
					<i class="fa-solid fa-triangle-exclamation fa-fade"></i>
				</a>
			</h2>
			
		</div>
	</div>
	
	<div class="row">
		<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
    
            <h2  class="mt-5 mb-3">Map view of {{ cafes | count() }} cafes</h2>
            
            {{cafemap.html}}
			
			<hr>
			
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                      List View of Cafes                                        -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	
	<!-- Table tile and Add a cafe button -->
	<div class="row">
		<div class="col-lg-8 col-md-10 col-sm-12 mx-auto my-3">
	
			<!-- Button to expose hidden options -->
			<a class="btn btn-primary float-left" data-toggle="collapse" href="#collapseCafeList" role="button"
			   aria-expanded="false" aria-controls="collapseExample" id="show_cafes">
				List view
	        </a>
			
			<!-- Add a cafe button -->
			{% if current_user.is_authenticated and current_user.can_post_cafe() %}
				<a class="btn btn-primary float-right" href="{{ url_for('new_cafe') }}">
					<i class="fa-solid fa-circle-plus fa-beat fa-xl"></i> add cafe
				</a>
			{% endif %}
			
		</div>
	</div>
	
	
	<!-- Collapsed button tab -->
	<div class="collapse" id="collapseCafeList">
		<div class="row">
			<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
	
		        {% if mobile %}
					<table id="cafeTable" class="table table-striped table-bordered table-condensed">
				{% else %}
					<table id="cafeTable" class="table table-striped table-bordered" style="width: 730px">
				{% endif %}
			
					<!-- Header -->
					<thead>
	                    <tr>
		                    {% if not mobile %}
		                        <th scope="col">#</th>
		                    {% endif %}
	                        <th scope="col">Name</th>
	                        <th scope="col">Rating</th>
	                        <th scope="col">Routes</th>
		                    {% if not mobile %}
		                        <th scope="col">Summary</th>
		                    {% endif %}
	                    </tr>
	                </thead>
			
					<tbody>
						{% for cafe in cafes %}
						
							<tr>
								{% if not mobile %}
		                        	<td scope="row">{{ cafe.id }}</td>
								{% endif %}
								<td scope="row">
									<a href="{{ url_for('cafe_details', cafe_id=cafe.id) }}">
										{{ cafe.name }}
										{% if cafe.image_name %}
											<i class="fa-solid fa-image"></i>
										{% endif %}
										{% if cafe.website_url %}
											<i class="fa-solid fa-link"></i>
										{% endif %}
									</a>
								</td>
								<td scope="row">{{ cafe.rating }}</td>
	                            <td scope="row">{{ number_routes_passing_by(cafe.id, current_user) }}</td>
								{% if not mobile %}
									<td scope="row">{{ cafe.summary }}</td>
								{% endif %}
						    </tr>
						
						{% endfor %}
					</tbody>
				
				</table>
		  
			</div>
		</div>
		
		 <!-- 2nd Add a new cafe button -->
        <div class="row">
			<div class="col-lg-8 col-md-10 col-sm-12 mx-auto my-3">
	
				<!-- Must have permission to post -->
				{% if current_user.is_authenticated and current_user.can_post_cafe() %}
					<a class="btn btn-primary float-right" href="{{ url_for('new_cafe') }}">
						<i class="fa-solid fa-circle-plus fa-beat fa-xl"></i> Add cafe
					</a>
				{% else %}
					<a class="btn btn-primary disabled float-right">Log in to add a cafe.</a>
				{% endif %}
	
			</div>
        </div>
		        
		
	</div>

	<!-- Separator before next section -->
	<div class="row mb-3">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Table                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
		
		$('#cafeTable').DataTable({
		
			/* Default table length */
			pageLength: 20,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
			
		})
		
		/* Cafes - Hide <-> Show buttons name change */
		$("#collapseCafeList").on("show.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'HIDE list';
        });
       $("#collapseCafeList").on("hide.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'List view';
        });
		
	} );
	
</script>



{% endblock %}
