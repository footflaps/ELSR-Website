{% extends "base.html" %}


<!---------------------------------------------------------------------------------------------------->
<!--                                   Page specific JS / CSS                                       -->
<!---------------------------------------------------------------------------------------------------->

{% block head %}
	
	<!-- dataTables Bootstrap 4 CSS -->
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">

	<!-- DataTables 1.13.6 -->
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"
	        integrity="sha384-k5vbMeKHbxEZ0AEBTSdR7UjAgWCcUfrS8c0c5b2AfIh7olfhNkyCZYwOfzOQhauK"
	        crossorigin="anonymous"></script>
	
	<!-- DataTables Bootstrap 3 integration -->
	<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap.min.js"
	        integrity="sha384-xX2rLG/IDoD8nMCCawO1tSmnmivygPR0hHih92wcA9NqItz/WQBRYL3LcGloEQnU"
	        crossorigin="anonymous"></script>

{% endblock %}




{% block content %}

<!---------------------------------------------------------------------------------------------------->
<!--                                 Bootstrap WTForm Support                                       -->
<!---------------------------------------------------------------------------------------------------->

{% import "bootstrap/wtf.html" as wtf %}


<!---------------------------------------------------------------------------------------------------->
<!--                                     Page Header                                                -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead"
        style="background-image: url({{ url_for('static', filename='img/page-headers/user-bg.jpg') }})"
		alt="Frozen brake lever">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					
					<!-- Gravatar and user name -->
					<h1>
						<a href="https://gravatar.com/">
							<img src="{{ user.email | gravatar }}"
						         width="100" height="100"
						         style="border-radius: 50%;"
							     alt="Gravatar icon"/>
						</a>
				        {{ user.name }}
					</h1>
					
					<!-- Privacy -->
					<span class="subheading">This page is private to you.</span>
					
					<!-- Member since -->
					<span class="subheading">Member since {{ beautify_date(user.start_date) }}</span>
					
					<!-- 2FA -->
					{% if user.has_valid_phone_number() %}
						<span class="subheading">
							<i class="fa-solid fa-user-lock"></i>
							Using 2FA to secure this account.
						</span>
					{% endif %}

				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}


<!---------------------------------------------------------------------------------------------------->
<!--                                        Messages                                                -->
<!---------------------------------------------------------------------------------------------------->

<a name="messages" ></a>
{% if messages %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
		
				<!-- Shorter description on smaller screens -->
				{% if mobile %}
					{% if messages | count == 1 %}
						<h2 class="post-title float-left">{{ messages | count }} Message:</h2>
					{% else %}
						<h2 class="post-title float-left">{{ messages | count }} Messages:</h2>
					{% endif %}
				{% elif current_user.email == user.email %}
					{% if messages | count == 1 %}
						<h2 class="post-title float-left">You have {{ messages | count }} Message:</h2>
					{% else %}
						<h2 class="post-title float-left">You have {{ messages | count }} Messages:</h2>
					{% endif %}
				{% else %}
					{% if messages | count == 1 %}
						<h2 class="post-title float-left">{{ user.name }} has {{ messages | count }} Message:</h2>
					{% else %}
						<h2 class="post-title float-left">{{ user.name }} has {{ messages | count }} Messages:</h2>
					{% endif %}
				{% endif %}
				
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseMessageList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_messages">
	                   SHOW
	            </a>
				
			</div>
		</div>

		<div class="collapse" id="collapseMessageList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
	
					<div class="accordion" id="accordionExample">
						
						{% for message in messages %}
						
							<!-- The message -->
							<div class="card">
								
								<!-- Header -->
								<div class="card-header" id="heading{{loop.index}}">
									<h5 class="mb-0">
										{% if message.been_read() %}
											<button class="btn-sm btn-secondary mr-2" type="button"
											        data-toggle="collapse"
											        data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope-open fa-xl"></i>
												Message {{ loop.index }}
											</button>
										{% else %}
											<button class="btn-sm btn-primary mr-2" type="button"
											        data-toggle="collapse"
											        data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope fa-xl"></i>
												Message {{ loop.index }}
											</button>
										{% endif %}
									</h5>
								</div>
								
								<!-- Body -->
								<div id="collapse{{loop.index}}" class="collapse"
								     aria-labelledby="heading{{loop.index}}"
								     data-parent="#accordionExample">
									<div class="card-body">
										
										<!-- Email details -->
										<strong>From: {{ message.from_name }}</strong><br>
										<strong>Date: {{ message.sent_date }}</strong><br>
										{{ message.body }}
										
										<hr>
								
										<!-- Read / unread buttons -->
										{% if message.been_read() %}
										
											<!-- Mini form to mark a message unread -->
											<form action="{{ url_for('mark_unread', message_id=message.id, return_path=url_for('user_page', user_id=user.id, anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as unRead</button>
											</form>
	
										{% else %}
										
											<!-- Mini form to mark a message read -->
											<form action="{{ url_for('mark_read', message_id=message.id, return_path=url_for('user_page', user_id=user.id, anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as Read</button>
											</form>

										{% endif %}
										
										<!-- Mini form to delete a message -->
										<form action="{{ url_for('delete_message', message_id=message.id, return_path=url_for('user_page', user_id=user.id, anchor='messages')) }}"
										      method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" class="btn-sm btn-danger float-right mb-3 ">Delete</button>
										</form>
										
										<!-- Reply button -->
										<button class="btn-sm btn-primary mr-2 mb-3 float-right"
										        data-toggle="modal" data-target="#replyModal{{message.id}}"
									            type="button">Reply</button>
				
									</div>
								</div>
							
							</div>
						
							<!---------------------------------------------------------------------------------------------------->
							<!--                                   Modal form for reply message                                 -->
							<!---------------------------------------------------------------------------------------------------->
							
							<div class="modal fade" id="replyModal{{message.id}}" tabindex="-1" role="dialog"
							     aria-labelledby="exampleModalLabel" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="replyLabel">Don't let them have the last word...</h5>
											
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<!--
												NB To get the two parameters use:
													1. gpx_id = request.args.get('gpx_id', None)
							                        2. confirm = request.form['confirm']
											-->
											<form action="{{ url_for('reply_message', message_id=message.id, return_path=url_for('user_page', anchor='messages', user_id=user.id)) }}" method="post">
												
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												
												<div class="form-group">
													<label  class="col-form-label">
													Try and think of something witty to say! But then you were never
													much of a comedian...</label>
													<textarea class="form-control" name="body" rows="6"></textarea>
												</div>
												
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
													<button type="submit" class="btn btn-primary">Have Some of that!</button>
												</div>
												
											</form>
										</div>
									</div>
								</div>
							</div>  <!-- End of modal form -->

						
						{% endfor %}
						
					</div>
				</div>
			</div>
		</div>
	
		<!-- Separator before next section -->
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>

	</div>

{% endif %}

	
<!---------------------------------------------------------------------------------------------------->
<!--                                      List view of cafes                                        -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
	
			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ cafes|length }} cafes:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ cafes|length }} cafes:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ cafes|length }} cafes:</h2>
				{% endif %}
			{% endif %}
			
			{% if cafes | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseCafeList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_cafes">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>

	{% if cafes | count > 0: %}
	
		<!-- Collapsed / Hidden table of cafes -->
		<div class="collapse" id="collapseCafeList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="cafeTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
				
						<!-- Header row-->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
		                        <th scope="col">Name</th>
			                    <th scope="col">Routes</th>
			                    {% if not mobile %}
			                        <th scope="col">Added</th>
			                    {% endif %}
			                </tr>
		                </thead>
				
						<!-- Table rows -->
						<tbody>
							{% for cafe in cafes: %}
								
								{% if cafe.active %}
									<tr>
								{% else %}
									<tr class="table-warning">
								{% endif %}
							
									<th scope="row">{{ loop.index }}</th>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=cafe.id) }}">
											{{ cafe.name }}
										</a>
									</td>
								    <td scope="row">{{ number_routes_passing_by(cafe.id, current_user) }}</td>
									{% if not mobile %}
										<td scope="row">{{ cafe.added_date }}</td>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
					<p>NB Cafes shown in yellow are marked as closed or closing.</p>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
</div>



<!---------------------------------------------------------------------------------------------------->
<!--                               Table of all user's routes                                       -->
<!---------------------------------------------------------------------------------------------------->

<!--
	Jinja's variables have very limited scope, eg they don't last beyond loop iterations. So you can't just
	create 'hidden' in the loop below and use it at the end. The fix is to add it to the namespace variables.
-->
{% set ns = namespace(hidden="") %}
	
<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ gpxes|length }} routes:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ gpxes|length }} routes:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ gpxes|length }} routes:</h2>
				{% endif %}
			{% endif %}
			
			{% if gpxes | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseGPXList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_gpx">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if gpxes | count > 0: %}
	
		<!-- Collapsed / Hidden table of routes -->
		<div class="collapse" id="collapseGPXList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="gpxTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
					
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
		                        <th scope="col">Name</th>
		                        <th scope="col">Length (km)</th>
		                        <th scope="col">Ascent (m)</th>
			                    {% if not mobile %}
		                            <th scope="col">Added</th>
			                    {% endif %}
		                    </tr>
		                </thead>
				
						<tbody>
							{% for gpx in gpxes: %}
								
								{% if not gpx.public(): %}
									<!-- We have hidden rows for non public routes -->
									<tr class="table-warning">
									{% set ns.hidden = "NB Routes in yellow have not been made public yet by their owner and are only visible to Admins
						                                and the owner. Only the owner can publish the route and make it public." %}
								{% else: %}
									<tr>
								{% endif %}
									
									<th scope="row">{{ loop.index }}</th>
									<td scope="row">
										<a href="{{ url_for('gpx_details', gpx_id=gpx.id) }}">{{ gpx.name }}</a>
									</td>
									<th scope="row">{{ gpx.length_km }}</th>
		                            <td scope="row">{{ gpx.ascent_m }}</td>
									{% if not mobile %}
		                                <td scope="row">{{ gpx.date }}</td>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
					<!-- If we had hidden routes, we add a note here to explain what yellow means -->
					<p>{{ ns.hidden }}</p>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
</div>

	
<!---------------------------------------------------------------------------------------------------->
<!--                         Table of all user's comments on cafes                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ cafe_comments|length }} comments:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ cafe_comments|length }} comments:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ cafe_comments|length }} comments:</h2>
				{% endif %}
			{% endif %}
			
			{% if cafe_comments | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseCommentList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_comments">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if cafe_comments | count > 0: %}
	
		<!-- Collapsed / Hidden table of comments -->
		<div class="collapse" id="collapseCommentList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="commentTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Cafe</th>
			                    <th scope="col">Comment</th>
			                    {% if not mobile %}
			                        <th scope="col">Added</th>
			                    {% endif %}
			                </tr>
		                </thead>
				
						<tbody>
							{% for comment in cafe_comments: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">{{ get_cafe_name_from_id(comment.cafe_id) }}</td>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=comment.cafe_id) }}">
											{{ remove_html_tags(comment.body) }}
										</a>
									</td>
									{% if not mobile %}
										<td scope="row">{{ beautify_date(comment.date) }}</td>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                         Table of all user's rides in calendar                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ rides|length }} rides:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ rides|length }} rides:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ rides|length }} rides:</h2>
				{% endif %}
			{% endif %}
			
			{% if rides | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseRideList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_rides">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if rides | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseRideList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="rideTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Destination</th>
			                    <th scope="col">Group</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for ride in rides: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">
										<a href="{{ url_for('weekend', date=ride.date) }}">
											{{ beautify_date(ride.date) }}
										</a>
									</td>
									<td scope="row">
										<!-- Might not have a cafe_id set -->
										{% if ride.cafe_id %}
											<a href="{{ url_for('cafe_details', cafe_id=ride.cafe_id) }}">
												{{ ride.destination }}
											</a>
										{% else %}
											{{ ride.destination }}
										{% endif %}
									</td>
									<td scope="row">{{ ride.group }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                Table of all socials in calendar                                -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ socials|length }} socials:</h2>
			{% elif current_user.email == user.email %}
				<h2 class="post-title float-left">You have {{ socials|length }} social events:</h2>
			{% else %}
				<h2 class="post-title float-left">{{ user.name }} has {{ socials|length }} social events:</h2>
			{% endif %}
			
			{% if socials | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseSocialList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_socials">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if socials | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseSocialList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="socialTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Host</th>
			                    <th scope="col">Destination</th>
			                    <th scope="col">Owner</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for social in socials: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">
										<a href="{{ url_for('calendar', date=social.date) }}">
											{{ beautify_date(social.date) }}
										</a>
									</td>
									<td scope="row">{{ social.organiser }}</td>
									<td scope="row">
										<a href="{{ url_for('social') }}">
											{{ social.destination }}
										</a>
									</td>
									<td scope="row">{{ get_user_name(social.email) }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                    Table of all blog posts                                     -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ blogs|length }} blogs:</h2>
			{% elif current_user.email == user.email %}
				<h2 class="post-title float-left">You have {{ blogs|length }} blog posts:</h2>
			{% else %}
				<h2 class="post-title float-left">{{ user.name }} has {{ blogs|length }} blog posts:</h2>
			{% endif %}
			
			{% if blogs | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseBlogList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_blogs">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if blogs | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseBlogList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="blogTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Title</th>
			                    <th scope="col">Category</th>
			                    <th scope="col">Private</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for blog in blogs: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">{{ blog.date }}</td>
									<td scope="row">
										<a href="{{ url_for('blog', blog_id = blog.id) }}">{{ blog.title }}</a>
									</td>
									<td scope="row">{{ blog.category }}</td>
									<td scope="row">{{ blog.privacy }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                Table of all classifieds posts                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ classifieds|length }} classifieds:</h2>
			{% elif current_user.email == user.email %}
				<h2 class="post-title float-left">You have {{ classifieds|length }} classifieds:</h2>
			{% else %}
				<h2 class="post-title float-left">{{ user.name }} has {{ classifieds|length }} classified posts:</h2>
			{% endif %}
			
			{% if classifieds | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseClassifiedList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_classifieds">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if classifieds | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseClassifiedList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="classifiedTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Title</th>
			                    <th scope="col">Category</th>
			                    <th scope="col">Price</th>
			                    <th scope="col">Status</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for classified in classifieds: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">{{ beautify_date(classified.date) }}</td>
									<td scope="row">
										<a href="{{ url_for('classifieds', classified_id = classified.id) }}">{{ classified.title }}</a>
									</td>
									<td scope="row">{{ classified.category }}</td>
									<td scope="row">£{{ classified.price }}</td>
									<td scope="row">{{ classified.status }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                          Events                                                -->
<!---------------------------------------------------------------------------------------------------->

{% if current_user.admin() %}

	<a name="eventLog"></a>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				
				<!-- Shorter description on smaller screens -->
				{% if mobile %}
					<h2 class="post-title float-left">{{ events|count }} events in {{ days }} days:</h2>
				{% elif current_user.id == user.id %}
					<h2 class="post-title float-left">You have {{ events|count }} events in {{ days }} days:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ events|count }} events in {{ days }} days:</h2>
				{% endif %}
				
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseEventList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_events">
	                   SHOW
	            </a>
				
			</div>
		</div>
		
		<!-- Collapsed / Hidden table of cafes -->
		<div class="collapse" id="collapseEventList">
			<div class="row mt-4">
				<div class="col-lg-8 col-md-10 mx-auto">
					
					<!-- Use a button group -->
					<div class="btn-group mb-4" role="group">
					
						<!-- Change selection -->
						{% if days == "all" %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days='all') }}">
								All
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days='all') }}">
								All
							</a>
						{% endif %}
						
						{% if days == 28 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=28) }}">
								4 Weeks
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days=28) }}">
								4 Weeks
							</a>
						{% endif %}
						
						{% if days == 7 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=7) }}">
								1 Week
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days=7) }}">
								1 Week
							</a>
						{% endif %}
						
						{% if days == 1 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=1) }}">
								24 hr
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary 3" href="{{ url_for('user_page', user_id=user.id, days=1) }}">
								24 hr
							</a>
						{% endif %}
						
						<!-- Delete Events (Super Admin only) -->
						{% if current_user.id == 1 %}
							<button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteEventsModal">
		                        Delete
							</button>
						{% endif %}
						
					</div>
					
				</div>
				
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="eventTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 0, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
							<tr>
								<th scope="col">ID</th>
								<th scope="col">Name</th>
								<th scope="col">Date</th>
								<th scope="col">Type</th>
								<th scope="col">Event</th>
							</tr>
						</thead>
						
						<tbody>
							{% for event in events|reverse: %}
							
								{% if flag_event(event.type) %}
									<tr class="table-danger">
								{% elif good_event(event.type) %}
									<tr class="table-success">
								{% elif toandfro_event(event.type) %}
									<tr class="table-warning">
								{% else %}
									<tr>
								{% endif %}
							
									<td scope="row" class="small">
										{{ event.id }}

										<form action="{{ url_for('delete_event', event_id=event.id, user_id=user.id) }}" method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" style="background: none; border: none;">✘</button>
										</form>
									
									</td>
									<td class="small">{{ get_user_name(event.email) }}</td>
									<td class="small">{{ readable_date(event.date) }}</td>
									<td class="small">{{ event.type }}</td>
									<td class="small">{{ event.details }}</td>
								</tr>
							
							{% endfor %}
						</tbody>
					
					</table>
				
				</div>
			</div>
		</div>
	</div>

	<!-- Separator before next section -->
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>
	</div>

{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                  Account Mgmt Tools                                            -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">Account:</h2>
			{% else %}
				{% if current_user.id == user.id %}
					<h2 class="post-title float-left">Manage my account:</h2>
				{% else %}
					<h2 class="post-title float-left">Manage {{ user.name }}'s account:</h2>
				{% endif %}
			{% endif %}
			
			<!-- Button to expose hidden options -->
			<a class="btn btn-primary float-right" data-toggle="collapse" href="#collapseAccount" role="button"
			   aria-expanded="false" aria-controls="collapseExample" id="show_account">
                   SHOW
            </a>
	
		</div>
	</div>
	
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<!-- Collapsed button tab -->
			<div class="collapse" id="collapseAccount">
				<div class="card card-body my-3">
	                <div class="clearfix">
		
		                <!---------------------------------------------------------------------------------------->
						<!--                                      Summary                                       -->
						<!---------------------------------------------------------------------------------------->
		                
		                <h4>Account details for:</h4>
		                <ul>
			                <li>User: '<strong>{{ user.name }}</strong>'</li>
			                <li>Email: '<strong>{{ user.email }}</strong>'</li>
			                {% if user.has_valid_phone_number() %}
			                    <li>Mobile: '<strong>{{ user.phone_number }}</strong>'</li>
			                {% elif user.has_unvalidated_phone_number() %}
			                    <li>Mobile: '<strong>{{ user.phone_number }}</strong>' [unverified]</li>
			                {% endif %}
			                <li>Start date: '<strong>{{ beautify_date(user.start_date) }}</strong>'</li>
			                <li>Last login: '<strong>{{ user.last_login }}</strong>' from '<strong>{{ user.last_login_ip }}</strong>'</li>
		                </ul>
		                
		                <hr>
		                
		                <!---------------------------------------------------------------------------------------->
						<!--                             Change user details form                               -->
						<!---------------------------------------------------------------------------------------->
		    
			            {{ wtf.quick_form(form, novalidate=True, button_map={"submit": "primary"}) }}
		                
		                <hr>
		    
		                <!---------------------------------------------------------------------------------------->
						<!--                                 Notifications                                      -->
		                <!---------------------------------------------------------------------------------------->
		                <a name="account"></a>
		                <h4>Receive email notifications:</h4>
		                <!-- This is our way of passing back the checkbox options -->
		                <script>
		                    let choices = 0;
		                </script>
		                
		                {% for notification in notifications %}
		                
			                <div class="form-check">
				                {% if notification.status %}
							        <input class="form-check-input" type="checkbox" checked=""
							               id="defaultCheck{{ loop.index }}" style="width: 20px; height: 20px; ">
							        <!-- Set initial value -->
				                    <script>
		                                choices +=  2**{{ loop.index }};
		                            </script>
				                {% else %}
				                    <input class="form-check-input" type="checkbox"
							               id="defaultCheck{{ loop.index }}" style="width: 20px; height: 20px; ">
				                {% endif %}
							           
							    <label class="form-check-label" for="defaultCheck{{ loop.index }}">
							        &nbsp; {{ notification.name }}
							    </label>
							</div>
		                
		                {% endfor %}
		                
		                <!-- Update preferences -->
		                <!-- Button starts disabled and gets enabled by JS when they change something -->
                         <form id="updatelink" action="" method="post">
	                         <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
	                         <input type="hidden" name="user_id" value="{{ user.id }}"/>
				                <button disabled type="submit" class="btn btn-primary mt-3" id="updatechoices">
				                    Update choices
			                    </button>
                         </form>
					
		                <!-- Each checkbox gets its own JS handler -->
		                 <!-- Trap checkbox changes and 1) un-disable the button 2) update the value of choices -->
		                <script>
		                    {% for notification in notifications %}
		                       $("#defaultCheck{{ loop.index }}").on("change", function(){
						            // Enable the update button
						            document.getElementById("updatechoices").disabled = false;
						            // Update our choices value
						            if (document.querySelector("#defaultCheck{{ loop.index }}").checked)
						            {
						                choices = choices + 2**{{ loop.index }}
						            } else {
						                choices = choices - 2**{{ loop.index }}
						            };
						            // Update the <a> to have a valid hyperlink and pass back the value of choices
						            //document.getElementById("updatelink").href = `/?choices=${choices}`;
						            document.getElementById("updatelink").action = `/set_notifications?choices=${choices}`;
						       });
						    {% endfor %}
		                 </script>
		                <hr>
		                
		                <!---------------------------------------------------------------------------------------->
						<!--                                     2FA                                            -->
						<!---------------------------------------------------------------------------------------->
		                
		                <h4>Two Factor Authentication:</h4>
		                
		                <!-- Manage phone number -->
	                    {% if user.has_valid_phone_number() %}
		                
		                    <!-- NB An Admin can't change their phone number whilst an admin -->
							{% if not user.admin() %}
		                    
		                        <!-- Edit existing phone number -->
		                        <a data-toggle="modal" data-target="#editPhoneModal">
				                    <button type="button" class="btn btn-secondary mt-2">Edit my
					                    <i class="fa-solid fa-mobile-retro fa-xl"></i>
				                    </button>
								</a>
	                    
		                    {% else %}
		                
		                        <!-- Disabled Edit button -->
	                            <button type="button" class="btn btn-dark disabled float_left mt-2">Edit my
				                    <i class="fa-solid fa-mobile-retro fa-xl"></i>
			                    </button>
							
		                        <!-- Test SMS button -->
		                        <a href="{{ url_for('test_sms') }}">
		                            <button type="button" class="btn btn-primary float-right mt-2">Test SMS
					                    <i class="fa-solid fa-mobile-retro fa-xl"></i>
				                    </button>
			                    </a>
		                
		                        <p>NB Admins can't change their 2FA mobile as it would lock them out.</p>
		                
	                        {% endif %}
	                    
		                {% elif user.has_unvalidated_phone_number() %}
	                    
	                        <!-- Validate existing phone number -->
	                        <form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
								<input type="hidden" name="phone_number" value="{{ user.phone_number }}"/>
								<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
								<button type="submit" class="btn btn-primary mt-2">Verify my
									<i class="fa-solid fa-mobile-retro fa-xl"></i>
								</button>
							</form>
	                 
		                {% else %}
	                    
	                        <!-- Add phone number -->
	                        <a data-toggle="modal" data-target="#addPhoneModal">
			                    <button type="button" class="btn btn-primary mt-2">Add my
				                    <i class="fa-solid fa-mobile-retro fa-xl"></i>
			                    </button>
							</a>
	                 
		                {% endif %}
		                
		                <hr>
		               
		                <!---------------------------------------------------------------------------------------->
						<!--                                User permissions                                    -->
						<!---------------------------------------------------------------------------------------->
		                
		                <h4>User permissions:</h4>
		                 
		                <table id="permTable" class="table table-striped table-bordered table-sm table-condensed"
					       style="width: 100%">
				
							<!-- Header -->
							<thead>
								<tr>
									<th scope="col">Action</th>
									<th scope="col">Permission</th>
								</tr>
							</thead>
	                  
			                <!-- Body -->
	                        <tbody>
		                        <tr>
									<td class="small">Can download GPXes</td>
									<td class="small">
										<i class="fa-regular fa-face-smile fa-xl"></i>
									</td>
								</tr>
								<tr>
									<td class="small">Can upload GPXes</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                        <tr>
									<td class="small">Can add and comment on Cafes</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                       <tr>
									<td class="small">Can add events and socials to Calendar</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                        <tr>
									<td class="small">Can add blog posts</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                        <tr>
									<td class="small">Can add classifieds</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                        <tr>
									<td class="small">Can see Private events</td>
									<td class="small">
										{% if user.readwrite() %}
											<i class="fa-regular fa-face-smile fa-xl"></i>
										{% else %}
											<i class="fa-regular fa-face-sad-tear fa-xl"></i>
										{% endif %}
									</td>
								</tr>
		                   </tbody>
				
						</table>
		                
		                <div>
			                {% if current_user.id == user.id : %}
							    
			                    <!-- Contact an admin -->
								<a data-toggle="modal" data-target="#contactAdminModal">
									<button type="button" class="btn btn-primary float-right ml-3">Contact an Admin</button>
								</a>
							
			                {% else %}
			                
			                  <!-- Message the user -->
								<a data-toggle="modal" data-target="#contactUserModal">
									<button type="button" class="btn btn-primary float-right ml-3">Message '{{ user.name }}'</button>
								</a>
			     
							{% endif %}
			                
			                <p>NB New users may have
			                   restricted permissions until an Admin can confirm their identity.</p>
				        
			            </div>
			               
		                <hr>
		                 <a name="notifications"></a>
						<!---------------------------------------------------------------------------------------->
						<!--                                  Admin tools                                       -->
						<!---------------------------------------------------------------------------------------->
						
		                <!-- Options for managing another user -->
						{% if current_user.admin() and current_user.id != user.id %}
						
		                    <h4>Admin tools for '{{ user.name }}' ({{ user.email }}):</h4>
		                
		                    <!-- Send Verification Code -->
		                    {% if not user.verified() %}
			                    <a href="{{ url_for('reverify_user', user_id=user.id) }}">
									<button type="button" class="btn btn-secondary mr-2 my-2">Verification</button>
			                    </a>
		                    {% endif %}
		                
			                <!-- Send Password Reset Code -->
			                <a href="{{ url_for('password_reset_user', user_id=user.id) }}">
			                    <button type="button" class="btn btn-secondary mr-2 my-2">Send PSW Reset</button>
							</a>
		        
		                    <!-- Make Admin -->
		                    {% if current_user.id == 1 and not user.blocked() %}
		                        {% if user.admin() %}
		                            <a data-toggle="modal" data-target="#unmakeAdminModal">
										<button type="button" class="btn btn-danger mr-2 my-2" >unAdmin</button>
			                        </a>
		                        {% elif user.phone_number %}
			                        <a data-toggle="modal" data-target="#makeAdminModal">
										<button type="button" class="btn btn-danger mr-2 my-2" >Make Admin</button>
			                        </a>
		                        {% else %}
		                           	<button type="button" class="btn btn-dark mr-2 my-2" >Make Admin</button>
			                    {% endif %}
		                    {% endif %}
		                
							<!-- Block / unBlock user -->
							{% if user.blocked(): %}
		                        <a data-toggle="modal" data-target="#unBlockUserModal">
									<button type="button" class="btn btn-danger mr-2 my-2" >unBan User</button>
		                        </a>
							{% else: %}
		                        <a data-toggle="modal" data-target="#blockUserModal">
									<button type="button" class="btn btn-danger mr-2 my-2" >Ban User</button>
		                        </a>
							{% endif %}
							
		                    <!-- Allow / Disable Write permissions -->
							{% if user.readwrite(): %}
		                        <a data-toggle="modal" data-target="#removeWriteUserModal">
									<button type="button" class="btn btn-warning mr-2 my-2" >Read only</button>
		                        </a>
							{% else: %}
		                        <a data-toggle="modal" data-target="#allowWriteUserModal">
									<button type="button" class="btn btn-primary mr-2 my-2" >Read Write</button>
		                        </a>
							{% endif %}
		                
		                    <hr>
		                
						{% endif %}
					
						
						<!---------------------------------------------------------------------------------------------->
						<!--                                 User's tools                                             -->
						<!---------------------------------------------------------------------------------------------->
						
		                <h4>Account Control:</h4>
		                
						{% if current_user.id == user.id : %}
						
		                    <!-- Log out button -->
							<a href="{{ url_for('logout') }}">
								<button type="button" class="btn btn-warning float-right">Log out</button>
							</a>
						
						{% endif %}
						
						
						{% if current_user.admin(): %}
					
							<a data-toggle="modal" data-target="#deleteUserModal">
								<button type="button"
								        class="btn btn btn-danger float-left">Delete user's account
								</button>
							</a>
						
						{% else %}
					
							<a data-toggle="modal" data-target="#deleteUserModal">
								<button type="button"
								        class="btn btn btn-danger float-left">Delete my account
								</button>
							</a>
		                
		                {% endif %}
						
		            </div>
				</div>
		    </div>
					
			<!-- For some reason the buttons sit on the break line, so need some margin -->
			<hr class="mt-3">

		</div>
	</div>
</div>



<!---------------------------------------------------------------------------------------------------->
<!--                                            WhatsApp                                            -->
<!---------------------------------------------------------------------------------------------------->

{% if current_user.readwrite() %}
	
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
	  
	            <h2>WhatsApp:</h2>
	            
	            <p>We have a ELSR WhatsApp group. You can join using
		            <a href="https://chat.whatsapp.com/LMaPKlAoA3G1yKfY7lE3VV"><strong>WhatsApp Invite Link</strong>
		            </a>
		            link.
	            </p>
			
				<hr>
				
			</div>
		</div>
	</div>

{% endif %}

<!---------------------------------------------------------------------------------------------------->
<!--                                             GDPR                                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
  
            <h2>GDPR:</h2>
            
            <p>As you have an account on this site, we are storing some personal data of yours e.g. your email address.
               Our GDPR Policy can be found here:
	            <a href="{{ url_for('gdpr') }}"><strong>ELSR GDPR</strong>.
	            </a>
            </p>
		
			<hr>
			
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                              Script to allow page jump to anchor                               -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	{% if anchor == 'messages' %}
		
		/* Open collapsed section */
		$("#collapseMessageList").collapse('show');
        
        /* Change button name */
        document.getElementById('show_messages').innerHTML = 'HIDE';
        
        /* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	    
	{% elif anchor == 'eventLog' %}
	
		/* Open collapsed section */
		$("#collapseEventList").collapse('show');
  
        /* Change button name */
        document.getElementById('show_events').innerHTML = 'HIDE';
  
		/* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	
	{% elif anchor == 'account' or anchor == 'notifications' %}
	
		/* Open collapsed section */
		$("#collapseAccount").collapse('show');
  
        /* Change button name */
        document.getElementById('show_account').innerHTML = 'HIDE';
  
		/* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	
	{% endif %}
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Tables                                    -->
<!--                                SHOW <-> HIDE Button labels                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
	
		/* jQuery on our tables where we want dataTables to run */
		$('#cafeTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#gpxTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#commentTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#rideTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#socialTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		$('#blogTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		$('#classifiedTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		$('#eventTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		/* Messages - Hide <-> Show buttons name change */
		$("#collapseMessageList").on("show.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'HIDE';
        });
       $("#collapseMessageList").on("hide.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'SHOW';
        });
				
		/* Cafes - Hide <-> Show buttons name change */
		$("#collapseCafeList").on("show.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'HIDE';
        });
       $("#collapseCafeList").on("hide.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'SHOW';
        });
        
        /* GPX - Hide <-> Show buttons name change */
		$("#collapseGPXList").on("show.bs.collapse", function(){
            document.getElementById('show_gpx').innerHTML = 'HIDE';
        });
       $("#collapseGPXList").on("hide.bs.collapse", function(){
            document.getElementById('show_gpx').innerHTML = 'SHOW';
        });
        
        /* Comments - Hide <-> Show buttons name change */
		$("#collapseCommentList").on("show.bs.collapse", function(){
            document.getElementById('show_comments').innerHTML = 'HIDE';
        });
       $("#collapseCommentList").on("hide.bs.collapse", function(){
            document.getElementById('show_comments').innerHTML = 'SHOW';
        });
        
       /* Rides - Hide <-> Show buttons name change */
		$("#collapseRideList").on("show.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'HIDE';
        });
       $("#collapseRideList").on("hide.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'SHOW';
        });
        
       /* Socials - Hide <-> Show buttons name change */
		$("#collapseSocialList").on("show.bs.collapse", function(){
            document.getElementById('show_socials').innerHTML = 'HIDE';
        });
       $("#collapseSocialList").on("hide.bs.collapse", function(){
            document.getElementById('show_socials').innerHTML = 'SHOW';
        });
        
        /* Blogs - Hide <-> Show buttons name change */
		$("#collapseBlogList").on("show.bs.collapse", function(){
            document.getElementById('show_blogs').innerHTML = 'HIDE';
        });
       $("#collapseBlogList").on("hide.bs.collapse", function(){
            document.getElementById('show_blogs').innerHTML = 'SHOW';
        });
        
        /* Classifieds - Hide <-> Show buttons name change */
		$("#collapseClassifiedList").on("show.bs.collapse", function(){
            document.getElementById('show_classifieds').innerHTML = 'HIDE';
        });
       $("#collapseClassifiedList").on("hide.bs.collapse", function(){
            document.getElementById('show_classifieds').innerHTML = 'SHOW';
        });
        
       /* Events - Hide <-> Show buttons name change */
		$("#collapseEventList").on("show.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'HIDE';
        });
       $("#collapseEventList").on("hide.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'SHOW';
        });
        
        /* Account - Hide <-> Show buttons name change */
		$("#collapseAccount").on("show.bs.collapse", function(){
            document.getElementById('show_account').innerHTML = 'HIDE';
        });
       $("#collapseAccount").on("hide.bs.collapse", function(){
            document.getElementById('show_account').innerHTML = 'SHOW';
        });
        
	} );
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for deleting events                                    -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="deleteEventsModal" tabindex="-1" role="dialog" aria-labelledby="deleteEventsModal"
     aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteEventsModal2">Delete all {{ user.name }}'s events for {{ days }} days?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_events', days=days, user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">CANCEL</button>
						<button type="submit" class="btn btn-danger">INITIATE PURGE</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming user delete                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteUserModal1">Can't take it anymore?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							If you really have had enough and are not prepared to cut down your steerer tube, you
							can make it all stop by entering <strong>your password</strong> in the box below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						{% if user.id == current_user.id %}
							<button type="button" class="btn btn-primary" data-dismiss="modal">I'll stay</button>
							<button type="submit" class="btn btn-danger">I can't take it anymore</button>
						{% else %}
							<button type="button" class="btn btn-primary" data-dismiss="modal">CLOSE</button>
							<button type="submit" class="btn btn-danger">DELETE USER</button>
						{% endif %}
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming barring user                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="blockUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="blockModalLabel">Temporarily block user from logging in</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('block_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming unbarring user                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="unBlockUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="unBlockModalLabel">Remove block on user logging in</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('unblock_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming making Admin                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="makeAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="makeAdminLabel">Make user {{ user.name }} an Admin</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('make_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming removing Admin                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="unmakeAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="unmakeAdminLabel">Make user {{ user.name }} an Admin</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('unmake_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for contacting an admin                                -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="contactAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="contactAdminLabel">Are they picking on you again? </h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('message_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Either get that steerer tube cut down, or ask an Admin to make them stop. <br>
						Please leave a message in the box below and someone will
						eventually get back to you.</label>
						<textarea class="form-control" id="admin_message" name="admin_message" rows="6"></textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">HELP ME OBI-WAN</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for messaging the User                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="contactUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="contactUserLabel">Have they still not cut their steerer tube?</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('message_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Send them a message reminding them of club rules!</label>
						<textarea class="form-control" id="user_message" name="user_message" rows="6"></textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Cut that tube!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for add phone number                                   -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="addPhoneModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="addPhoneLabel">Add your phone number</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						If you want SMS alerts, add your phone number! Format should be +44xxxxxxxxxx.</label>
						<textarea class="form-control" id="phone_number" name="phone_number" rows="1">{{ user.phone_number }}
						</textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Fax me baby!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                             Modal form for edit phone number                                   -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="editPhoneModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editPhoneLabel">Add your phone number</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Edit your existing phone number! Format should be +44xxxxxxxxxx.
						NB. The new number will have to be verified.</label>
						<textarea class="form-control"  name="phone_number" rows="1">{{ user.phone_number }}
						<textarea class="form-control"  name="phone_number" rows="1">{{ user.phone_number }}
						</textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Fax me baby!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for giving user Write permissions                           -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="allowWriteUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" >Give user {{ user.name }} Write Access</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('user_readwrite', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for removing user Write permissions                         -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="removeWriteUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" >Remove user {{ user.name }} Write Access</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('user_readonly', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->



{% endblock %}
