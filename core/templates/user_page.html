{% extends "base.html" %}


{% block content %}


<!---------------------------------------------------------------------------------------------------->
<!--                                     Page Header                                                -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url({{ url_for('static', filename='img/user-bg.jpg')}})">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					
					<!-- Gravatar and user name -->
					<h1>
						<a href="https://gravatar.com/">
							<img src="{{ user.email | gravatar }}"
						         width="100" height="100"
						         style="border-radius: 50%;"/>
						</a>
				        {{user.name}}
					</h1>

					<!-- Member since -->
					<span class="subheading">Member since {{user.start_date}}</span>
					
					<!-- 2FA -->
					{% if user.has_valid_phone_number() %}
						<span class="subheading">
							<i class="fa-solid fa-user-lock"></i>
							Using 2FA to secure this account.
						</span>
					{% endif %}

				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}


<!---------------------------------------------------------------------------------------------------->
<!--                                        Messages                                                -->
<!---------------------------------------------------------------------------------------------------->

<a name="messages" ></a>
{% if messages %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
		
				{% if mobile %}
					{% if messages | count == 1 %}
						<h2 class="post-title float-left">{{ messages | count }} Message:</h2>
					{% else %}
						<h2 class="post-title float-left">{{ messages | count }} Messages:</h2>
					{% endif %}
				{% else %}
					{% if messages | count == 1 %}
						<h2 class="post-title float-left">You have {{ messages | count }} Message:</h2>
					{% else %}
						<h2 class="post-title float-left">You have {{ messages | count }} Messages:</h2>
					{% endif %}
				{% endif %}
				
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseMessageList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_messages">
	                   SHOW
	            </a>
				
			</div>
		</div>

		<div class="collapse" id="collapseMessageList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
	
					<div class="accordion" id="accordionExample">
						
						{% for message in messages %}
						
							<!-- The message -->
							<div class="card">
								
								<!-- Header -->
								<div class="card-header" id="heading{{loop.index}}">
									<h5 class="mb-0">
										{% if message.been_read() %}
											<button class="btn-sm btn-secondary mr-2" type="button"
											        data-toggle="collapse"
											        data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope-open fa-xl"></i>
												Message {{loop.index}}
											</button>
										{% else %}
											<button class="btn-sm btn-primary mr-2" type="button"
											        data-toggle="collapse"
											        data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope fa-xl"></i>
												Message {{loop.index}}
											</button>
										{% endif %}
									</h5>
								</div>
								
								<!-- Body -->
								<div id="collapse{{loop.index}}" class="collapse"
								     aria-labelledby="heading{{loop.index}}"
								     data-parent="#accordionExample">
									<div class="card-body">
										
										<!-- Email details -->
										<strong>From: {{ message.from_name }}</strong><br>
										<strong>Date: {{ message.sent_date }}</strong><br>
										{{ message.body }}
										
										<hr>
								
										<!-- Read / unread buttons -->
										{% if message.been_read() %}
										
											<!-- Mini form to mark a message unread -->
											<form action="{{ url_for('mark_unread', message_id=message.id, return_to=url_for('user_page', user_id=user.id, anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as unRead</button>
											</form>
	
										{% else %}
										
											<!-- Mini form to mark a message read -->
											<form action="{{ url_for('mark_read', message_id=message.id, return_to=url_for('user_page', user_id=user.id, anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as Read</button>
											</form>

										{% endif %}
										
										<!-- Mini form to delete a message -->
										<form action="{{ url_for('delete_message', message_id=message.id, return_to=url_for('user_page', user_id=user.id, anchor='messages')) }}"
										      method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" class="btn-sm btn-danger float-right mb-3 ">Delete</button>
										</form>
										
										<!-- Reply button -->
										<button class="btn-sm btn-primary mr-2 mb-3 float-right"
										        data-toggle="modal" data-target="#replyModal{{message.id}}"
									            type="button">Reply</button>
				
									</div>
								</div>
							
							</div>
						
							<!---------------------------------------------------------------------------------------------------->
							<!--                                   Modal form for reply message                                 -->
							<!---------------------------------------------------------------------------------------------------->
							
							<div class="modal fade" id="replyModal{{message.id}}" tabindex="-1" role="dialog"
							     aria-labelledby="exampleModalLabel" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="replyLabel">Don't let them have the last word...</h5>
											
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<!--
												NB To get the two parameters use:
													1. gpx_id = request.args.get('gpx_id', None)
							                        2. confirm = request.form['confirm']
											-->
											<form action="{{ url_for('reply_message', message_id=message.id, return_to=url_for('user_page', anchor='messages', user_id=user.id)) }}" method="post">
												
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												
												<div class="form-group">
													<label for="confirm" class="col-form-label">
													Try and think of something witty to say! But then you were never
													much of a comedian...</label>
													<textarea class="form-control" name="body" rows="6"></textarea>
												</div>
												
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
													<button type="submit" class="btn btn-primary">Have Some of that!</button>
												</div>
												
											</form>
										</div>
									</div>
								</div>
							</div>  <!-- End of modal form -->

						
						{% endfor %}
						
					</div>
				</div>
			</div>
		</div>
	
		<!-- Separator before next section -->
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>

	</div>

{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                   JavaScript for Google Maps (one or more cafes)                               -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
	    key: "{{ GOOGLE_MAPS_API_KEY }}",
	    v: "weekly",
	    // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
	    // Add other bootstrap parameters as needed, using camel case.
    });

	
	
	let map;
	
	async function initMap() {
        
        // Request needed libraries.
        const { Map, InfoWindow } = await google.maps.importLibrary("maps");
        const { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary("marker",);
        
        /* Define the map view */
        const map = new Map(document.getElementById("map"), {
            restriction: {
                latLngBounds: {{ MAP_BOUNDS | tojson }},
                strictBounds: false,
            },
            zoom: 9,
            center: { lat: {{ map_coords['lat'] }}, lng: {{ map_coords['lng'] }} },
            mapId: "7499929d658a3166",
        });

     	/* This is our set of cafes */
		const cafes = {{ cafe_markers | tojson }}
	    
	    // Create an info window to share between markers.
	    const infoWindow = new InfoWindow();
					
        // Create the markers.
        cafes.forEach( ({ position, title, color }, i) => {
            const pin = new PinElement({
            glyph: `${i + 1}`,
            });
            
            const marker = new AdvancedMarkerElement({
                position,
                map,
                title: `${title}`,
                content: new PinElement({
                                background: color,
                                borderColor: "black",
                                glyphColor: "black",
							}).element
            });
            
            // Add a click listener for each marker, and set up the info window.
            marker.addListener("click", ({ domEvent, latLng }) => {
                const { target } = domEvent;
                infoWindow.close();
                infoWindow.setContent(marker.title);
                infoWindow.open(marker.map, marker);
            });
        });
	}
	
	initMap();

</script>


<!---------------------------------------------------------------------------------------------------->
<!--                                       Map View of Cafes                                        -->
<!---------------------------------------------------------------------------------------------------->
	
{% if cafes | count > 0: %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				
				{% if mobile %}
		            <h2 class="mb-4">Map of your cafes:</h2>
				{% else %}
					<h2 class="mb-4">Map view of your {{ cafes | count }} cafes:</h2>
				{% endif %}
				
				<!---------------------------------------------------------------------------------------------------->
				<!--                                      Insert Google Map                                         -->
				<!---------------------------------------------------------------------------------------------------->
				
				<div id="map" style="height: 500px"></div>
				
	            <!-- Break before next section -->
				<hr>
				
			</div>
		</div>
	</div>
{% endif %}
	
	
<!---------------------------------------------------------------------------------------------------->
<!--                                      List view of cafes                                        -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
	
			{% if mobile %}
				<h2 class="post-title float-left">{{ cafes|length }} cafes:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ cafes|length }} cafes:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ cafes|length }} cafes:</h2>
				{% endif %}
			{% endif %}
			
			{% if cafes | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseCafeList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_cafes">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>

	{% if cafes | count > 0: %}
	
		<!-- Collapsed / Hidden table of cafes -->
		<div class="collapse" id="collapseCafeList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="cafeTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
				
						<!-- Header row-->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
		                        <th scope="col">Name</th>
			                    <th scope="col">Routes</th>
			                    {% if not mobile %}
			                        <th scope="col">Added</th>
			                    {% endif %}
			                </tr>
		                </thead>
				
						<!-- Table rows -->
						<tbody>
							{% for cafe in cafes: %}
								
								{% if cafe.active %}
									<tr>
								{% else %}
									<tr class="table-warning">
								{% endif %}
							
									<th scope="row">{{ loop.index }}</th>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=cafe.id) }}">
											{{ cafe.name }}
										</a>
									</td>
								    <td scope="row">{{ number_routes_passing_by(cafe.id, current_user) }}</td>
									{% if not mobile %}
										<th scope="row">{{ cafe.added_date }}</th>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
					<p>NB Cafes shown in yellow are marked as closed or closing.</p>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
</div>



<!---------------------------------------------------------------------------------------------------->
<!--                               Table of all user's routes                                       -->
<!---------------------------------------------------------------------------------------------------->

<!--
	Jinja's variables have very limited scope, eg they don't last beyond loop iterations. So you can't just
	create 'hidden' in the loop below and use it at the end. The fix is to add it to the namespace variables.
-->
{% set ns = namespace(hidden="") %}
	
<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			{% if mobile %}
				<h2 class="post-title float-left">{{ gpxes|length }} routes:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{ gpxes|length }} routes:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ user.name }} has {{ gpxes|length }} routes:</h2>
				{% endif %}
			{% endif %}
			
			{% if gpxes | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseGPXList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_gpx">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if gpxes | count > 0: %}
	
		<!-- Collapsed / Hidden table of routes -->
		<div class="collapse" id="collapseGPXList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="gpxTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
					
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
		                        <th scope="col">Name</th>
		                        <th scope="col">Length (km)</th>
		                        <th scope="col">Ascent (m)</th>
			                    {% if not mobile %}
		                            <th scope="col">Added</th>
			                    {% endif %}
		                    </tr>
		                </thead>
				
						<tbody>
							{% for gpx in gpxes: %}
								
								{% if not gpx.public(): %}
									<!-- We have hidden rows for non public routes -->
									<tr class="table-warning">
									{% set ns.hidden = "NB Routes in yellow have not been made public yet by their owner and are only visible to Admins
						                                and the owner. Only the owner can publish the route and make it public." %}
								{% else: %}
									<tr>
								{% endif %}
									
									<th scope="row">{{loop.index}}</th>
									<td scope="row"><a href="{{ url_for('gpx_details', gpx_id=gpx.id) }}">{{gpx.name}}</a></td>
									<th scope="row">{{gpx.length_km}}</th>
		                            <td scope="row">{{gpx.ascent_m}}</td>
									{% if not mobile %}
		                                <td scope="row">{{gpx.date}}</td>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
					<!-- If we had hidden routes, we add a note here to explain what yellow means -->
					<p>{{ ns.hidden }}</p>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
</div>

	
<!---------------------------------------------------------------------------------------------------->
<!--                         Table of all user's comments on cafes                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			{% if mobile %}
				<h2 class="post-title float-left">{{cafe_comments|length}} comments:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{cafe_comments|length}} comments:</h2>
				{% else %}
					<h2 class="post-title float-left">{{user.name}} has {{cafe_comments|length}} comments:</h2>
				{% endif %}
			{% endif %}
			
			{% if cafe_comments | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseCommentList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_comments">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if cafe_comments | count > 0: %}
	
		<!-- Collapsed / Hidden table of comments -->
		<div class="collapse" id="collapseCommentList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="commentTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Cafe</th>
			                    <th scope="col">Comment</th>
			                    {% if not mobile %}
			                        <th scope="col">Added</th>
			                    {% endif %}
			                </tr>
		                </thead>
				
						<tbody>
							{% for comment in cafe_comments: %}
								
								<tr>
									<td scope="row">{{loop.index}}</td>
									<td scope="row">{{ get_cafe_name_from_id(comment.article_id) }}</td>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=comment.article_id) }}">
											{{remove_html_tags(comment.body)}}
										</a>
									</td>
									{% if not mobile %}
										<td scope="row">{{comment.date}}</td>
									{% endif %}
							    </tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                         Table of all user's rides in calendar                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			{% if mobile %}
				<h2 class="post-title float-left">{{rides|length}} rides:</h2>
			{% else %}
				{% if user.id == current_user.id: %}
					<h2 class="post-title float-left">You have {{rides|length}} rides:</h2>
				{% else %}
					<h2 class="post-title float-left">{{user.name}} has {{rides|length}} rides:</h2>
				{% endif %}
			{% endif %}
			
			{% if rides | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseRideList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_rides">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if rides | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseRideList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="rideTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 0, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Destination</th>
			                    <th scope="col">Group</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for ride in rides: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">
										<a href="{{ url_for('weekend', date=ride.date) }}">
											{{ ride.date }}
										</a>
									</td>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=ride.cafe_id) }}">
											{{ ride.destination }}
										</a>
									</td>
									<td scope="row">{{ ride.group }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                          Events                                                -->
<!---------------------------------------------------------------------------------------------------->

{% if current_user.admin() %}

	<a name="eventLog" ></a>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				
				{% if mobile %}
					<h2 class="post-title float-left">{{ events|count }} events in {{ days }} days:</h2>
				{% elif current_user.id == user.id %}
					<h2 class="post-title float-left">You have {{ events|count }} events in {{ days }} days:</h2>
				{% else %}
					<h2 class="post-title float-left">User has {{ events|count }} events in {{ days }} days:</h2>
				{% endif %}
				
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseEventList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_events">
	                   SHOW
	            </a>
				
			</div>
		</div>
		
		<!-- Collapsed / Hidden table of cafes -->
		<div class="collapse" id="collapseEventList">
			<div class="row mt-4">
				<div class="col-lg-8 col-md-10 mx-auto">
					
					<!-- Use a button group -->
					<div class="btn-group mb-4" role="group">
					
						<!-- Change selection -->
						{% if days == "all" %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days='all') }}">
								All
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days='all') }}">
								All
							</a>
						{% endif %}
						
						{% if days == 28 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=28) }}">
								4 Weeks
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days=28) }}">
								4 Weeks
							</a>
						{% endif %}
						
						{% if days == 7 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=7) }}">
								1 Week
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary " href="{{ url_for('user_page', user_id=user.id, days=7) }}">
								1 Week
							</a>
						{% endif %}
						
						{% if days == 1 %}
							<a class="btn btn-sm btn-primary disabled " href="{{ url_for('user_page', user_id=user.id, days=1) }}">
								24 hr
							</a>
						{% else %}
							<a class="btn btn-sm btn-primary 3" href="{{ url_for('user_page', user_id=user.id, days=1) }}">
								24 hr
							</a>
						{% endif %}
						
						<!-- Delete Events (Super Admin only) -->
						{% if current_user.id == 1 %}
							<button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteEventsModal">
		                        Delete
							</button>
						{% endif %}
						
					</div>
					
				</div>
				
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="eventTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 0, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
							<tr>
								<th scope="col">ID</th>
								<th scope="col">Name</th>
								<th scope="col">Date</th>
								<th scope="col">Type</th>
								<th scope="col">Event</th>
							</tr>
						</thead>
						
						<tbody>
							{% for event in events|reverse: %}
							
								{% if flag_event(event.type) %}
									<tr class="table-danger">
								{% elif good_event(event.type) %}
									<tr class="table-success">
								{% elif toandfro_event(event.type) %}
									<tr class="table-warning">
								{% else %}
									<tr>
								{% endif %}
							
									<td scope="row" class="small">
										{{ event.id }}

										<form action="{{ url_for('delete_event', event_id=event.id, user_id=user.id) }}" method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" style="background: none; border: none;">✘</button>
										</form>
									
									</td>
									<td class="small">{{ get_user_name(event.email) }}</td>
									<td class="small">{{ readable_date(event.date) }}</td>
									<td class="small">{{ event.type }}</td>
									<td class="small">{{ event.details }}</td>
								</tr>
							
							{% endfor %}
						</tbody>
					
					</table>
				
				</div>
			</div>
		</div>
	</div>

	<!-- Separator before next section -->
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>
	</div>

{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                  Account Mgmt Tools                                            -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			{% if mobile %}
				<h2 class="post-title float-left">Account:</h2>
			{% else %}
				{% if current_user.id == user.id %}
					<h2 class="post-title float-left">Manage my account:</h2>
				{% else %}
					<h2 class="post-title float-left">Manage account:</h2>
				{% endif %}
			{% endif %}
			
			<!-- Button to expose hidden options -->
			<a class="btn btn-primary float-right" data-toggle="collapse" href="#collapseAccount" role="button"
			   aria-expanded="false" aria-controls="collapseExample" id="show_account">
                   SHOW
            </a>
	
		</div>
	</div>
	
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<!-- Collapsed button tab -->
			<div class="collapse" id="collapseAccount">
				<div class="card card-body my-3">
	                <div class="clearfix">
		
						<!---------------------------------------------------------------------------------------->
						<!--                                  Admin tools                                       -->
						<!---------------------------------------------------------------------------------------->
						
		                <!-- Options for managing another user -->
						{% if current_user.admin() and current_user.id != user.id %}
						
		                     <!-- Message the user -->
							<a data-toggle="modal" data-target="#contactUserModal">
								<button type="button" class="btn btn-primary my-2">Message User</button>
							</a>
		                
		                    <!-- Send Verification Code -->
		                    {% if not user.verified() %}
			                    <a href="{{ url_for('reverify_user', user_id=user.id) }}">
									<button type="button" class="btn btn-secondary mr-2 my-2">Verification</button>
			                    </a>
		                    {% endif %}
		                
			                <!-- Send Password Reset Code -->
			                <a href="{{ url_for('password_reset_user', user_id=user.id) }}">
			                    <button type="button" class="btn btn-secondary mr-2 my-2">Reset PSW</button>
							</a>
		        
		                    <!-- Make Admin -->
		                    {% if current_user.id == 1 and not user.blocked() %}
		                        {% if user.admin() %}
		                            <a data-toggle="modal" data-target="#unmakeAdminModal">
										<button type="button" class="btn btn-danger mr-2 my-2" >unAdmin</button>
			                        </a>
		                        {% else %}
			                        <a data-toggle="modal" data-target="#makeAdminModal">
										<button type="button" class="btn btn-danger mr-2 my-2" >Make Admin</button>
			                        </a>
		                        {% endif %}
		                    {% endif %}
		                
							<!-- Block / unBlock user -->
							{% if user.blocked(): %}
		                        <a data-toggle="modal" data-target="#unBlockUserModal">
									<button type="button" class="btn btn-warning my-2" >unBan User</button>
		                        </a>
							{% else: %}
		                        <a data-toggle="modal" data-target="#blockUserModal">
									<button type="button" class="btn btn-warning my-2" >Ban User</button>
		                        </a>
							{% endif %}
							
						{% endif %}
					
						
						<!---------------------------------------------------------------------------------------------->
						<!--                                 User's tools                                             -->
						<!---------------------------------------------------------------------------------------------->
						
						{% if current_user.id == user.id : %}
						
		                    <!-- Manage phone number -->
		                    {% if user.has_valid_phone_number() %}
		                        <!-- Edit existing phone number -->
								{% if not user.admin() %}
					                <!-- NB An Admin can't change their phone number whilst an admin -->
			                        <a data-toggle="modal" data-target="#editPhoneModal">
					                    <button type="button" class="btn btn-secondary mx-2 my-2">Edit Phone #</button>
									</a>
		                        {% endif %}
		                    {% elif user.has_unvalidated_phone_number() %}
		                        <!-- Validate existing phone number -->
		                        <form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
									<input type="hidden" name="phone_number" value="{{ user.phone_number }}"/>
									<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
									<button type="submit" class="btn btn-secondary mx-2 my-2">Verify Phone #</button>
								</form>
		                    {% else %}
		                        <!-- Add phone number -->
		                        <a data-toggle="modal" data-target="#addPhoneModal">
				                    <button type="button" class="btn btn-secondary mx-2 my-2">Add Phone #</button>
								</a>
		                    {% endif %}
		                
		                    <!-- Contact an admin -->
							<a data-toggle="modal" data-target="#contactAdminModal">
								<button type="button" class="btn btn-primary float-left my-2">Contact an Admin</button>
							</a>
						
		                    <!-- Log out button -->
							<a href="{{ url_for('logout') }}">
								<button type="button" class="btn btn-warning float-right my-2 ml-2">Log out</button>
							</a>
						
						{% endif %}
						
						<!---------------------------------------------------------------------------------------->
						<!--                                 Delete Account                                     -->
						<!---------------------------------------------------------------------------------------->
						
						{% if current_user.admin(): %}
					
							<a data-toggle="modal" data-target="#deleteUserModal">
								<button type="button"
								        class="btn btn btn-danger float-right my-2">Delete account
								</button>
							</a>
						
						{% else %}
					
							<a data-toggle="modal" data-target="#deleteUserModal">
								<button type="button"
								        class="btn btn btn-danger float-right my-2">Delete account
								</button>
							</a>
		                
		                {% endif %}
											
		            </div>
				</div>
		    </div>
					
			<!-- For some reason the buttons sit on the break line, so need some margin -->
			<hr class="mt-3">

		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                              Script to allow page jump to anchor                               -->
<!---------------------------------------------------------------------------------------------------->

<script>

	{% if anchor == 'messages' %}
		
		/* Open collapsed section */
		$("#collapseMessageList").collapse('show');
        
        /* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	    
	{% elif anchor == 'eventLog'%}
	
		/* Open collapsed section */
		$("#collapseEventList").collapse('show');
  
		/* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	
	{% endif %}
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Tables                                    -->
<!--                                SHOW <-> HIDE Button labels                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
	
		/* jQuery on our tables where we want dataTables to run */
		$('#cafeTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#gpxTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#commentTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#rideTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#eventTable').DataTable({
			
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		/* Messages - Hide <-> Show buttons name change */
		$("#collapseMessageList").on("show.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'HIDE';
        });
       $("#collapseMessageList").on("hide.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'SHOW';
        });
				
		/* Cafes - Hide <-> Show buttons name change */
		$("#collapseCafeList").on("show.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'HIDE';
        });
       $("#collapseCafeList").on("hide.bs.collapse", function(){
            document.getElementById('show_cafes').innerHTML = 'SHOW';
        });
        
        /* GPX - Hide <-> Show buttons name change */
		$("#collapseGPXList").on("show.bs.collapse", function(){
            document.getElementById('show_gpx').innerHTML = 'HIDE';
        });
       $("#collapseGPXList").on("hide.bs.collapse", function(){
            document.getElementById('show_gpx').innerHTML = 'SHOW';
        });
        
        /* Comments - Hide <-> Show buttons name change */
		$("#collapseCommentList").on("show.bs.collapse", function(){
            document.getElementById('show_comments').innerHTML = 'HIDE';
        });
       $("#collapseCommentList").on("hide.bs.collapse", function(){
            document.getElementById('show_comments').innerHTML = 'SHOW';
        });
        
       /* Rides - Hide <-> Show buttons name change */
		$("#collapseRideList").on("show.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'HIDE';
        });
       $("#collapseRideList").on("hide.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'SHOW';
        });
        
       /* Events - Hide <-> Show buttons name change */
		$("#collapseEventList").on("show.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'HIDE';
        });
       $("#collapseEventList").on("hide.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'SHOW';
        });
        
        /* Account - Hide <-> Show buttons name change */
		$("#collapseAccount").on("show.bs.collapse", function(){
            document.getElementById('show_account').innerHTML = 'HIDE';
        });
       $("#collapseAccount").on("hide.bs.collapse", function(){
            document.getElementById('show_account').innerHTML = 'SHOW';
        });
        
	} );
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for deleting events                                    -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="deleteEventsModal" tabindex="-1" role="dialog" aria-labelledby="deleteEventsModal"
     aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteEventsModal2">Delete all {{ user.name }}'s events for {{ days }} days?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_events', days=days, user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">CANCEL</button>
						<button type="submit" class="btn btn-danger">INITIATE PURGE</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming user delete                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteUserModal1">Can't take it anymore?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							If you really have had enough and are not prepared to cut down your steerer tube, you
							can make it all stop by entering <strong>your password</strong> in the box below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						{% if user.id == current_user.id %}
							<button type="button" class="btn btn-primary" data-dismiss="modal">I'll stay</button>
							<button type="submit" class="btn btn-danger">I can't take it anymore</button>
						{% else %}
							<button type="button" class="btn btn-primary" data-dismiss="modal">CLOSE</button>
							<button type="submit" class="btn btn-danger">DELETE USER</button>
						{% endif %}
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming barring user                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="blockUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="blockModalLabel">Temporarily block user from logging in</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('block_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming unbarring user                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="unBlockUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="unBlockModalLabel">Remove block on user logging in</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('unblock_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming making Admin                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="makeAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="makeAdminLabel">Make user {{ user.name }} an Admin</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('make_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                         Modal form for confirming removing Admin                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="unmakeAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="unmakeAdminLabel">Make user {{ user.name }} an Admin</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('unmake_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Submit</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for contacting an admin                                -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="contactAdminModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="contactAdminLabel">Are they picking on you again? </h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('message_admin', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Either get that steerer tube cut down, or ask an Admin to make them stop. <br>
						Please leave a message in the box below and someone will
						eventually get back to you.</label>
						<textarea class="form-control" id="admin_message" name="admin_message" rows="6"></textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">HELP ME OBI-WAN</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for messaging the User                                 -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="contactUserModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="contactUserLabel">Have they still not cut their steerer tube?</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('message_user', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Send them a message reminding them of club rules!</label>
						<textarea class="form-control" id="user_message" name="user_message" rows="6"></textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Cut that tube!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for add phone number                                   -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="addPhoneModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="addPhoneLabel">Add your phone number</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						If you want SMS alerts, add your phone number! Format should be +44xxxxxxxxxx.</label>
						<textarea class="form-control" id="phone_number" name="phone_number" rows="1">{{ user.phone_number }}
						</textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Fax me baby!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->


<!---------------------------------------------------------------------------------------------------->
<!--                             Modal form for edit phone number                                   -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="editPhoneModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editPhoneLabel">Add your phone number</h5>
				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('add_phone_number', user_id=user.id) }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
						Edit your existing phone number! Format should be +44xxxxxxxxxx.
						NB. The new number will have to be verified.</label>
						<textarea class="form-control"  name="phone_number" rows="1">{{ user.phone_number }}
						<textarea class="form-control"  name="phone_number" rows="1">{{ user.phone_number }}
						</textarea>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Fax me baby!</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>  <!-- End of modal form -->

{% endblock %}
