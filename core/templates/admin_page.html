{% extends "base.html" %}


{% block content %}


<!---------------------------------------------------------------------------------------------------->
<!--                                     Page Header                                                -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url({{ url_for('static', filename='img/admin-bg.jpg')}})">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					<h1>Admin Console</h1>
					<span class="subheading">The power of God!</span>
				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-warning text-center">
	{{ message }}
</div>
{% endfor %}
{% endif %}
{% endwith %}



<!---------------------------------------------------------------------------------------------------->
<!--                                        Messages                                                -->
<!---------------------------------------------------------------------------------------------------->

<a name="messages" ></a>
{% if messages %}
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
		
				{% if messages | count == 1 %}
					<h2 class="post-title float-left">{{ messages | count }} Message:</h2>
				{% else %}
					<h2 class="post-title float-left">{{ messages | count }} Messages:</h2>
				{% endif %}
				
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseMessageList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_messages">
	                   SHOW
	            </a>
				
			</div>
		</div>

		<div class="collapse" id="collapseMessageList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
	
					<div class="accordion" id="accordionExample">
				
						{% for message in messages %}
						
							<!------------------------------------------------------>
							<!--                   One Message                    -->
							<!------------------------------------------------------>
							<div class="card">
								
								<!-- Header -->
								<div class="card-header" id="heading{{loop.index}}">
									<h5 class="mb-0">
										<!-- Show different icon / button if read / unread -->
										{% if message.been_read() %}
											<button class="btn-sm btn-secondary mr-2" type="button" data-toggle="collapse" data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope-open fa-xl"></i>
												Message {{loop.index}}
											</button>
										{% else %}
											<button class="btn-sm btn-primary mr-2" type="button" data-toggle="collapse" data-target="#collapse{{loop.index}}"
										            aria-expanded="true" aria-controls="collapse{{loop.index}}">
												<i class="fa-regular fa-envelope fa-xl"></i>
												Message {{loop.index}}
											</button>
										{% endif %}
									</h5>
								</div>
								
								<!-- Body -->
								<div id="collapse{{loop.index}}" class="collapse" aria-labelledby="heading{{loop.index}}"
								     data-parent="#accordionExample">
									<div class="card-body">
										<strong>From: {{ message.from_name }}</strong><br>
										<strong>Date: {{ message.sent_date }}</strong><br>
										{{ message.body }}
										
										<hr>
										
										<!-- Reply Button -->
										<a data-toggle="modal" data-target="#replyMessageModal{{message.id}}">
											<button class="btn-sm btn-primary mr-2 float-left mb-3"
											        type="button">Reply</button>
										</a>
										
										<!-- Mark read / unread buttons -->
										{% if message.been_read() %}

											<!-- Mini form to mark a message unread -->
											<form class="form-group"
											      action="{{ url_for('mark_unread', message_id=message.id, return_to=url_for('admin_page', anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as unRead</button>
											</form>

										{% else %}

											<!-- Mini form to mark a message read -->
											<form class="form-group"
											      action="{{ url_for('mark_read', message_id=message.id, return_to=url_for('admin_page', anchor='messages')) }}"
											      method="post">
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												<button type="submit" class="btn-sm btn-secondary mr-2 float-left mb-3">Mark as Read</button>
											</form>

										{% endif %}

										<!-- Mini form to delete a message -->
										<form class="form-group"
										      action="{{ url_for('delete_message', message_id=message.id, return_to=url_for('admin_page', anchor='messages')) }}"
										      method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" class="btn-sm btn-danger float-right mb-3">Delete</button>
										</form>
										
									</div>
								</div>
							
							</div>
		
							<!------------------------------------------------------>
							<!--                 End of One Message               -->
							<!------------------------------------------------------>
						
							<!---------------------------------------------------------------------------------------------------->
							<!--                              Modal form for Reply to Message                                   -->
							<!---------------------------------------------------------------------------------------------------->
							
							<div class="modal fade" id="replyMessageModal{{message.id}}" tabindex="-1" role="dialog"
							     aria-labelledby="exampleModalLabel" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="replyMessageLabel{{message.id}}">Can't let someone else have the last word?</h5>
											
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
											<!--
												NB To get the two parameters use:
													1. gpx_id = request.args.get('gpx_id', None)
							                        2. confirm = request.form['confirm']
											-->
											<form action="{{ url_for('reply_message', message_id=message.id, return_to=url_for('admin_page', anchor='messages')) }}" method="POST">
												
												<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
												
												<div class="form-group">
													<label for="body" class="col-form-label">
														If you really must, enter your message here:
													</label>
													<textarea class="form-control" name="body" id="body" rows="6"></textarea>
												</div>
												
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
													<button type="submit" class="btn btn-primary">MUST HAVE LAST WORD</button>
												</div>
												
											</form>
										</div>
									</div>
								</div>
							</div>  <!-- End of modal form -->
						
						{% endfor %}
					
					</div> <!-- end of accordian -->
				</div> <!-- end of col -->
			</div> <!-- row -->
			
		</div>
	
		<!-- Separator before next section -->
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>

	</div>
	
{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                      Admin Table                                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">

	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			{% if admins | count == 1 %}
				<h2 class="post-title float-left">{{ admins | count }} Admin:</h2>
			{% else %}
				<h2 class="post-title float-left">{{ admins | count }} Admins:</h2>
			{% endif %}
			
			<!-- Button to expose hidden table -->
			<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseAdminList"
			   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_admins">
	            SHOW
	        </a>
			
		</div>
	</div>
	
	<!-- Collapsed / Hidden table of users -->
	<div class="collapse" id="collapseAdminList">
		<div class="row mt-3">
			<div class="col-lg-8 col-md-10 mx-auto">
				
				<table id="adminTable"
				       class="table table-striped table-bordered table-sm table-condensed"
				       style="width: 100%"
					   data-page-length="25">
					
					<!-- Header -->
					<thead>
						<tr>
							<th scope="col">ID</th>
							<th scope="col">Name</th>
							<th scope="col">Perm.</th>
							{% if not mobile %}
								<th scope="col">Start date</th>
							{% endif %}
							<th scope="col">Last Login</th>
							{% if current_user.admin() %}
								<th scope="col">Email</th>
							{% endif %}
						</tr>
					</thead>
				
					<tbody>
						{% for user in admins: %}
							{% if user.admin() %}
							<tr>
								<th scope="row">{{ user.id }}</th>
								<td><a href="{{ url_for('user_page', user_id=user.id) }}">{{ user.name }}</a></td>
								<td>
									{{ user.permissions }}
									{% if user.has_valid_phone_number() %}
										<i class="fa-solid fa-user-lock"></i>
									{% endif %}
								</td>
								{% if not mobile %}
									<td>{{ user.start_date }}</td>
								{% endif %}
								<td>{{ user.last_login }}  ({{ user.last_login_ip }})</td>
								{% if current_user.admin() %}
									<td>{{ user.email }}</td>
								{% endif %}
							</tr>
							
							{% endif %}
						{% endfor %}
					</tbody>
			
				</table>
			
			</div>
		</div>
	</div>
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>

	
<!---------------------------------------------------------------------------------------------------->
<!--                                       User Table                                               -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2 class="post-title float-left">{{ non_admins | count }} Users:</h2>
			
			<!-- Button to expose hidden table -->
			<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseUserList"
			   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_users">
	            SHOW
	        </a>
			
		</div>
	</div>

	<!-- Collapsed / Hidden table of users -->
	<div class="collapse" id="collapseUserList">
		<div class="row mt-3">
			<div class="col-lg-8 col-md-10 mx-auto">
				
				<table id="userTable" class="table table-striped table-bordered table-sm table-condensed"
					   style="width: 100%"
				       data-page-length="25">
			
					<!-- Header -->
					<thead>
						<tr>
							<th scope="col">ID</th>
							<th scope="col">Name</th>
							<th scope="col">Perm.</th>
							{% if not mobile %}
								<th scope="col">Start date</th>
							{% endif %}
							<th scope="col">Last Login</th>
							{% if current_user.admin() %}
								<th scope="col">Email</th>
							{% endif %}
						</tr>
					</thead>
					
					<tbody>
						{% for user in non_admins: %}
							
							<!--
								Colour code according to status
								Yellow      Not verified
								Read        Barred
							-->
							{% if user.blocked() %}
								<tr class="table-danger">
							{% elif not user.verified() %}
								<tr class="table-warning">
							{% else %}
								<tr>
							{% endif %}
							
								<td scope="row">{{ user.id }}</td>
								<td><a href="{{ url_for('user_page', user_id=user.id) }}">{{ user.name }}</a></td>
								<td>
									{{ user.permissions }}
									{% if user.has_valid_phone_number() %}
										<i class="fa-solid fa-user-lock"></i>
									{% endif %}
									{% if user.readwrite() %}
										<i class="fa-solid fa-user-pen"></i>
									{% endif %}
									{% if user.blocked() %}
										<i class="fa-solid fa-door-closed"></i>
									{% endif %}
								</td>
								{% if not mobile %}
									<td>{{ user.start_date }}</td>
								{% endif %}
								<td>{{ user.last_login }} ({{ user.last_login_ip }})</td>
								{% if current_user.admin() %}
									<td>{{ user.email }}
									    {% if user.phone_number %} {{ user.phone_number }} {% endif %}</td>
								{% endif %}
							</tr>
							
						{% endfor %}
					</tbody>
				
				</table>
			
				<p>Note: <br>
				   -- Users in Red have had their email address blocked. <br>
				   -- Users in yellow haven't verified their email addresses yet.</p>
						
			</div>
			
		</div>
	</div>
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                Table of all rides in calendar                                  -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{rides|length}} rides:</h2>
			{% else %}
				<h2 class="post-title float-left">There are {{rides|length}} rides:</h2>
			{% endif %}
			
			{% if rides | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseRideList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_rides">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if rides | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseRideList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="rideTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Leader</th>
			                    <th scope="col">Destination</th>
			                    <th scope="col">Group</th>
			                    <th scope="col">Owner</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for ride in rides: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">
										<a href="{{ url_for('weekend', date=ride.date) }}">
											{{ ride.date }}
										</a>
									</td>
									<td scope="row">{{ ride.leader }}</td>
									<td scope="row">
										<a href="{{ url_for('cafe_details', cafe_id=ride.cafe_id) }}">
											{{ ride.destination }}
										</a>
									</td>
									<td scope="row">{{ ride.group }}</td>
									<td scope="row">{{ get_user_name(ride.email) }}</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                Table of all socials in calendar                                -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">

			<!-- Shorter description on smaller screens -->
			{% if mobile %}
				<h2 class="post-title float-left">{{ socials|length }} socials:</h2>
			{% else %}
				<h2 class="post-title float-left">There are {{ socials|length }} social events:</h2>
			{% endif %}
			
			{% if socials | count > 0: %}
			
				<!-- Button to expose hidden table -->
				<a class="btn btn-primary float-right"  data-toggle="collapse" href="#collapseSocialList"
				   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_socials">
	                   SHOW
	            </a>
			
			{% endif %}
			
		</div>
	</div>
	
	{% if socials | count > 0: %}
	
		<!-- Collapsed / Hidden table of rides in Calendar -->
		<div class="collapse" id="collapseSocialList">
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<table id="socialTable" class="table table-striped table-bordered table-sm table-condensed"
					       data-order='[[ 1, "dec" ]]' data-page-length="25"
					       style="width: 100%">
				
						<!-- Header -->
						<thead>
		                    <tr>
		                        <th scope="col">#</th>
			                    <th scope="col">Date</th>
			                    <th scope="col">Host</th>
			                    <th scope="col">Destination</th>
			                    <th scope="col">Owner</th>
			                </tr>
		                </thead>
				
						<tbody>
							{% for social in socials: %}
								
								<tr>
									<td scope="row">{{ loop.index }}</td>
									<td scope="row">
										<a href="{{ url_for('social', date=social.date) }}">
											{{ social.date }}
										</a>
									</td>
									<td scope="row">{{ social.organiser }}</td>
									<td scope="row">{{ social.destination }}</td>
									<td scope="row">
										<a href="{{ url_for('user_page', user_id=get_user_id_from_email(social.email)) }}">
											{{ get_user_name(social.email) }}
										</a>
									</td>
								</tr>
						
							{% endfor %}
						
						</tbody>
					
					</table>
					
				</div>
			</div>
		</div>
	
	{% endif %}
	
	<!-- Separator before next section -->
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                          Events                                                -->
<!---------------------------------------------------------------------------------------------------->

<a name="eventLog" ></a>
<div class="container">
	
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2 class="post-title float-left">Event Log:</h2>
			
			<!-- Button to expose hidden table -->
			<a class="btn btn-primary float-right" data-toggle="collapse" href="#collapseEventList"
			   role="button" aria-expanded="false" aria-controls="collapseExample" id="show_events">
	            SHOW
	        </a>
			
		</div>
	</div>

	<!-- Collapsed / Hidden table of cafes -->
	<div class="collapse" id="collapseEventList">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto my-5">
				
				<!-- Use a button group -->
				<div class="btn-group float-right" role="group">
				
					<!-- Change selection -->
					{% if days == "all" %}
						<a class="btn btn-sm btn-primary disabled" href="{{ url_for('admin_page', days='all') }}">
							All
						</a>
					{% else %}
						<a class="btn btn-sm btn-primary" href="{{ url_for('admin_page', days='all') }}">
							All
						</a>
					{% endif %}
					
					{% if days == 28 %}
						<a class="btn btn-sm btn-primary disabled" href="{{ url_for('admin_page', days=28 ) }}">
							4 Weeks
						</a>
					{% else %}
						<a class="btn btn-sm btn-primary" href="{{ url_for('admin_page', days=28 ) }}">
							4 Weeks
						</a>
					{% endif %}
					
					{% if days == 7 %}
						<a class="btn btn-sm btn-primary disabled" href="{{ url_for('admin_page', days=7 ) }}">
							1 Week
						</a>
					{% else %}
						<a class="btn btn-sm btn-primary" href="{{ url_for('admin_page', days=7 ) }}">
							1 Week
						</a>
					{% endif %}
					
					{% if days == 1 %}
						<a class="btn btn-sm btn-primary disabled" href="{{ url_for('admin_page', days=1) }}">
							24 hr
						</a>
					{% else %}
						<a class="btn btn-sm btn-primary" href="{{ url_for('admin_page', days=1) }}">
							24 hr
						</a>
					{% endif %}
				
					<!-- Delete Events (Super Admin only) -->
					{% if current_user.id == 1 %}
						<button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteEventsModal">
	                        Delete
						</button>
					{% endif %}
					
					<!-- Delete 404s (Super Admin only) -->
					{% if current_user.id == 1 %}
						<button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#delete404Modal">
	                        Delete 404s
						</button>
					{% endif %}
					
				</div> <!-- End button group -->
			</div> <!-- End column -->
		</div> <!-- End row -->
	
		<!-- Summary count -->
		<div class="row my-2">
			<div class="col-lg-8 col-md-10 mx-auto">
				<h4>{{ events|count }} events in {{ days }} days</h4>
			</div>
		</div>
		
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
	
				<table id="eventTable" class="table table-striped table-bordered table-sm table-condensed"
					data-order='[[ 0, "dec" ]]' data-page-length="25"
				    style="width: 100%">
			
					<!-- Header -->
					<thead>
						<tr>
							<th scope="col">ID</th>
							<th scope="col">Name</th>
							<th scope="col">Date</th>
							<th scope="col">Type</th>
							<th scope="col">Event</th>
						</tr>
					</thead>
					
					<tbody>
						{% for event in events: %}
							{% if not mobile or event.type != "404" %}
							
								{% if flag_event(event.type) %}
									<tr class="table-danger">
								{% elif good_event(event.type) %}
									<tr class="table-success">
								{% elif toandfro_event(event.type) %}
									<tr class="table-warning">
								{% else %}
									<tr>
								{% endif %}
							
									<td scope="row" class="small">
										{{ event.id }}
										
										<!-- Mini form to delete an event -->
										<form action="{{ url_for('delete_event', event_id=event.id) }}" method="post">
											<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
											<button type="submit" style="background: none; border: none;">✘</button>
										</form>
										
									</td>
									<td class="small">{{ get_user_name(event.email) }}</td>
									<td class="small">{{ readable_date(event.date) }}</td>
									<td class="small">{{ event.type }}</td>
									<td class="small">{{ event.details }}</td>
								</tr>
							{% endif %}
						{% endfor %}
					</tbody>
			
				</table>
			
				{% if not events: %}
					<h4>No events over the last {{ days }} days</h4>
				{% endif %}
			
			</div>
		</div>
	</div>
	
	<!-- Separator before next section -->
	<div class="row mb-3">
		<div class="col-lg-8 col-md-10 mx-auto">
			<hr>
		</div>
	</div>
	
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Open page at Events anchor                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	{% if anchor == 'messages' %}
		
		/* Open collapsed section */
		$("#collapseMessageList").collapse('show');
        
        /* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	    
	{% elif anchor == 'eventLog'%}
	
		/* Open collapsed section */
		$("#collapseEventList").collapse('show');
  
		/* Jump to anchor */
        window.location = (""+window.location).replace(/#[A-Za-z0-9_]*$/,'')+"#{{anchor}}"
	
	{% endif %}
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Tables                                    -->
<!--                                SHOW <-> HIDE Button labels                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
	
		/* jQuery on our tables where we want dataTables to run */
		$('#userTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		});
		
		$('#rideTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		$('#socialTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		$('#eventTable').DataTable({
			
			/* Default table length */
			pageLength: 25,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
		})
		
		/* Messages - Hide <-> Show buttons name change */
		$("#collapseMessageList").on("show.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'HIDE';
        });
       $("#collapseMessageList").on("hide.bs.collapse", function(){
            document.getElementById('show_messages').innerHTML = 'SHOW';
        });
		
		/* Admins - Hide <-> Show buttons name change */
		$("#collapseAdminList").on("show.bs.collapse", function(){
            document.getElementById('show_admins').innerHTML = 'HIDE';
        });
       $("#collapseAdminList").on("hide.bs.collapse", function(){
            document.getElementById('show_admins').innerHTML = 'SHOW';
        });
        
        /* Users - Hide <-> Show buttons name change */
		$("#collapseUserList").on("show.bs.collapse", function(){
            document.getElementById('show_users').innerHTML = 'HIDE';
        });
       $("#collapseUserList").on("hide.bs.collapse", function(){
            document.getElementById('show_users').innerHTML = 'SHOW';
        });
        
        /* Rides - Hide <-> Show buttons name change */
		$("#collapseRideList").on("show.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'HIDE';
        });
       $("#collapseRideList").on("hide.bs.collapse", function(){
            document.getElementById('show_rides').innerHTML = 'SHOW';
        });
        
        /* Socials - Hide <-> Show buttons name change */
		$("#collapseSocialList").on("show.bs.collapse", function(){
            document.getElementById('show_socials').innerHTML = 'HIDE';
        });
       $("#collapseSocialList").on("hide.bs.collapse", function(){
            document.getElementById('show_socials').innerHTML = 'SHOW';
        });
        
		/* Events - Hide <-> Show buttons name change */
		$("#collapseEventList").on("show.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'HIDE';
        });
       $("#collapseEventList").on("hide.bs.collapse", function(){
            document.getElementById('show_events').innerHTML = 'SHOW';
        });
       
	} );
	
</script>


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for deleting events                                    -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="deleteEventsModal" tabindex="-1" role="dialog" aria-labelledby="deleteEventsModal"
     aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteEventsModal2">Delete all events for {{ days }} days?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_events', days=days, user_id='admin') }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">CANCEL</button>
						<button type="submit" class="btn btn-danger">INITIATE PURGE</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                              Modal form for deleting 404s                                      -->
<!---------------------------------------------------------------------------------------------------->

<div class="modal fade" id="delete404Modal" tabindex="-1" role="dialog" aria-labelledby="delete404Moda"
     aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="delete404Modal2">Delete all 404 events?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!--
					NB To get the two parameters use:
						1. gpx_id = request.args.get('gpx_id', None)
                        2. confirm = request.form['confirm']
				-->
				<form action="{{ url_for('delete_404s') }}" method="post">
					
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
					
					<div class="form-group">
						<label class="col-form-label">
							Enter <strong>your password</strong> below.
						</label>
						<input type="password" class="form-control" name="password">
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">CANCEL</button>
						<button type="submit" class="btn btn-danger">INITIATE PURGE</button>
					</div>
					
				</form>
			</div>
		</div>
	</div>
</div>

{% endblock %}



{% block scripts %}
{% endblock %}