{% extends "base.html" %}


{% block content %}


<!---------------------------------------------------------------------------------------------------->
<!--                                       Page Header                                              -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url('{{ url_for('static', filename='img/gravel-bg.jpg')}}')">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					<h1>Gravel</h1>
					<span class="subheading">What do you mean you don't have a Gravel bike?</span>
				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}


<!---------------------------------------------------------------------------------------------------->
<!--                                      Main Content                                              -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2>It's like mountain biking from the 1980s</h2>
			
			<p>
				In case you've been living as a hermit for the last 5 years, Gravel riding and Gravel Packing is
				the 'in thing' currently. Every man and his dog is adding a Gravel Bike to their stable. So,
				obviously ELsr has jumped on the bandwagon and is milking this trend for all it's worth!
			</p>
			
			<p>
				East Anglia might not be the most exciting place in the UK to gravel bike, but we have a good selection
				of bridleways and a very dry climate, which means lots of trails which are rideable almost all year
				round.
			</p>
			
			<p>
				We also have a few long distance trails in our region which are ideal for gravel packing!
			</p>
			
			<ul>
				<li>Peddars Way: Details <a href="https://www.norfolk.gov.uk/out-and-about-in-norfolk/norfolk-trails/cycle-routes/peddars-way"><strong>here.</strong></a></li>
				<li>Rebellion Way: Details <a href="https://www.cyclinguk.org/rebellion-way"><strong>here.</strong></a></li>
				<li>Wolf Way and it's various children: Details <a href="https://www.cyclinguk.org/route/wolf-way"><strong>here.</strong></a></li>
			</ul>
			
			<hr>
			
		</div>
	</div>
</div>




<!---------------------------------------------------------------------------------------------------->
<!--                                       List GPX Routes                                          -->
<!---------------------------------------------------------------------------------------------------->

<!--
	Jinja variables have very limited scope, eg they don't last beyond loop iterations. So you can't just
	create 'hidden' in the loop below and use it at the end. The fix is to add it to the namespace variables.
-->
{% set ns = namespace(hidden="") %}

<div class="container">
	
	<!-- Table of all the routes -->
	<div class="row">
		<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
			
			<h2 class="mb-3">Gravel GPXes</h2>
			
			<table id="gpxTable" class="table table-striped table-bordered table-sm table-condensed"
			       data-page-length="25"
			       style="width: 100%">
			
				<!-- Header -->
				<thead>
                    <tr>
	                    {% if not mobile %}
                            <th scope="col">ID</th>
	                    {% endif %}
                        <th scope="col">Name</th>
                        <th scope="col">Length (km)</th>
                        <th scope="col">Ascent (m)</th>
	                    <th scope="col">Type</th>
	                    {% if not mobile %}
	                        <th scope="col">Uploaded by</th>
	                    {% endif %}
                    </tr>
                </thead>
		
				<tbody>
					{% for gpx in gpxes: %}
					
						<!--
							Criteria for being to see a route is:
								1. It's public
								2. You're Admin (can see all)
								3. You are the author of the route
						-->
						
						<!-- Tortuous logic: current_user.admin() doesn't exist until they log in -->
						{% if not current_user.is_authenticated and not gpx.public(): %}
					
							<!-- Skip this row -->
					
						{% elif gpx.public() or current_user.admin() or gpx.email == current_user.email: %}
							
							{% if gpx.id in missing_files: %}
								<tr class="table-danger">
							{% elif not gpx.public(): %}
								<!-- We have hidden rows for non public routes -->
								<tr class="table-warning">
								{% set ns.hidden = "NB Routes in yellow have not been made public yet by their owner and are only visible to Admins
				                                 and the owner. Only the owner can publish the route and make it public." %}
							{% else %}
								<tr>
							{% endif %}
							
							{% if not mobile %}
								<td scope="row">{{ gpx.id }}</td>
							{% endif %}
							<td scope="row"><a href="{{ url_for('gpx_details', gpx_id=gpx.id) }}">{{ gpx.name }}</a></td>
							<td scope="row">{{ gpx.length_km }}</td>
                            <td scope="row">{{ gpx.ascent_m }}</td>
							<td scope="row">{{ gpx.type }}</td>
							{% if not mobile %}
								<td scope="row">{{ get_user_name(gpx.email) }}</td>
							{% endif %}
					    </tr>
						{% endif %}
					{% endfor %}
				</tbody>
			
			</table>
			
			<!-- If we had hidden routes, we add a note here to explain what yellow means -->
			<p>{{ ns.hidden }}</p>
			
			
			<p>
				To add a GPX file, go to the GPX list page <a href="{{ url_for('gpx_list') }}"><strong>here.</strong></a>
			</p>
			
		</div>
	</div>
	
</div>


<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
		
			<!-- Break before footer -->
			<hr>
		
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Table                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
		$('#gpxTable').dataTable({
		
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
			
		})
	} );
	
</script>


{% endblock %}