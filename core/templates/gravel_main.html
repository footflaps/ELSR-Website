{% extends "base.html" %}


{% block content %}


<!---------------------------------------------------------------------------------------------------->
<!--                                       Page Header                                              -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url('{{ url_for('static', filename='img/gravel-bg.jpg')}}')">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					<h1>Gravel</h1>
					<span class="subheading">What do you mean you don't have a Gravel bike?</span>
				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}



<!---------------------------------------------------------------------------------------------------->
<!--                                         Quick Links                                            -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
		
			<h2>Gravel Links</h2>
			
			<ul>
				<li>Routes from Cambridge</li>
				<li>Long Distance Trails</li>
				<li>All Gravel GPXes</li>
			</ul>
	
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                      WhatsApp Group                                            -->
<!---------------------------------------------------------------------------------------------------->

<!-- Readwrite users can see WA link -->
{% if current_user.is_authenticated: %}
	{% if current_user.readwrite() %}

		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
				
					<h2>ELSR Gravel WhatsApp Group</h2>
				
					<p>
						We have a WhatsApp Group for discussing Gravel Rides. You can join using
						<a href="https://chat.whatsapp.com/BYNwRtOx8dnEmqmxOqWEvo"><strong>this link.</strong></a>
					</p>
			
				</div>
			</div>
		</div>

	{% endif %}
{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                           Intro                                                -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2>It's like mountain biking from the 1980s</h2>
			
			<p>
				In case you've been living as a hermit for the last 5 years, Gravel riding and Gravel Packing is
				the 'in thing' currently. Every man and his dog is adding a Gravel Bike to their stable. So,
				obviously ELsr has jumped on the bandwagon and is milking this trend for all it's worth!
			</p>
			
			<p>
				East Anglia might not be the most exciting place in the UK to gravel bike, but we have a good selection
				of bridleways and a very dry climate, which means lots of trails which are rideable almost all year
				round. There are good train connections from Cambridge to the coast, which gives lots of option e.g.
				ride out, train back etc.
			</p>
			
			<p>
				Our local trails are definitely at the easier end of gravel riding with virtually no technical sections,
				unlike say The Lake District or Mid Wales. However, they are pretty fast rolling and given how flat the
				region is, you are able to cover good distances very easily e.g. the Fastest Known Time for the 372 km
				Rebellion Way is a staggering 13h:30m! See
				<a href="https://www.strava.com/activities/9674738731"><strong>Strava.</strong></a>
				However, we would recommend a slightly more leisurely approach, e.g. splitting the route over three
				days and enjoying the scenary.
			</p>
			
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                           Gravel Bikes                                         -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2>What is a Gravel Bike?</h2>
			
			<p>
				A very good question! With the current trend of road bikes accepting wider and wider tyres, the
				difference between modern road bikes and gravel bikes is shrinking. Typically, a gravel bike will take
				anything up to 55mm tyres with good clearance for mud and / or mudguards. The geometry will be
				slightly more relaxed (longer wheelbase and slacker head tube angle). This will favour stability over
				razor sharp handling and make the bike easier to ride over rough terrain. They also tend to have a
				more upright position e.g. slightly shorter reach and higher stack than road specific frames.
			</p>
			<p>
				However, the single biggest difference in handling comes from running wider tyres at lower pressures,
				which make a big difference to how the bike feels on bridleways etc. For out local trails, you won't be
				pushing the upper bounds of technical riding, so a more road orientated frame with some 35mm tyres will
				probably be absolutely fine.
			</p>
			<p>
				If you find gravel ride a bit battering on the wrists or hands, there are some excellent solutions out
				there e.g. I use a
				<a href="https://www.youtube.com/watch?v=jL4kzCsiJfM"><strong>RedShift stem </strong></a>
				on my Gravel Bike, which makes a huge difference to how rough the trails feel and how far you can ride.
			</p>
			
			<p>
				NB Worth noting that the <a href="https://www.rsf.org.uk/"><strong>Rough Stuff Fellowship</strong></a>
				have been riding (or often carrying) normal road bikes offroad for a very long time e.g. when it
				was compulsory to smoke a pipe and wear shorts in winter even for ladies.
			</p>
			
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                                        Gravel Packing                                          -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2>What is a Gravel Packing?</h2>
			
			<p>
				Traditional panniers are so 1980s. Every outdoor company under the sun is now selling soft, strap on
				luggage for gravel bikes. E.g. for one or two nights B&Bing I use:
			</p>
			
			<ul>
				<li>10 litre saddle bag carrying spare shoes and clothes</li>
				<li>3 litre frame bag carrying pump, tools, tubes and small lock</li>
				<li>7 litre bar bag carrying gilet, waterproof, food, wallet and suncream etc (normally half empty)</li>
			</ul>
			
			<img class="mt-2" src="{{ url_for('static', filename='/img/free-ranger.jpg') }}"
			     style="width: 100%; border: 4px solid #000;">
							
			<p>
				If you're using B&Bs, then you only really need a change of clothes for the evening and maybe a spare
				pair of cycle shorts and a toothbrush. Spare shoes take up most of the space, but it's nice to give
				your feet a rest and your cycling shoes could easily be wet. If you're camping then you're going to
				need a lot more kit and be a lot more inventive in how you pack it e.g. see
				<a href="https://www.youtube.com/watch?v=gItut2g9_3k"><strong>Juliet Elliott's set up.</strong></a>
			</p>
			
		</div>
	</div>
</div>

<!---------------------------------------------------------------------------------------------------->
<!--                                      Long Distance Trails                                      -->
<!---------------------------------------------------------------------------------------------------->

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
			
			<h2>Long Distance Trails</h2>
			<p>
				We also have a few long distance trails in our region which are ideal for gravel packing. Whilst they
				don't start from Cambridge, they are easy to reach by train eg Peddars Way and Rebellion Way can be
				reached by a short train ride to Thetford.
			</p>
			
			<ul>
				<li>Peddars Way: Details
					<a href="https://www.norfolk.gov.uk/out-and-about-in-norfolk/norfolk-trails/cycle-routes/peddars-way"><strong>here.</strong></a></li>
				<li>Rebellion Way: Details
					<a href="https://www.cyclinguk.org/rebellion-way"><strong>here.</strong></a></li>
				<li>Wolf Way and it's various derivatives: Details
					<a href="https://www.cyclinguk.org/route/wolf-way"><strong>here.</strong></a></li>
			</ul>
			
			<hr>
			
		</div>
	</div>
</div>





<!---------------------------------------------------------------------------------------------------->
<!--                       JavaScript for Google Map showing multiple GPX files                     -->
<!---------------------------------------------------------------------------------------------------->

{% if polylines and GOOGLE_MAPS_API_KEY %}

	<script>
	
		(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
		    key: "{{ GOOGLE_MAPS_API_KEY }}",
		    v: "weekly",
		    // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
		    // Add other bootstrap parameters as needed, using camel case.
	    });
		
		let gpx_map;
		
		async function initGpxMap() {
	        
	        /* Request needed libraries */
	        const { Map, InfoWindow } = await google.maps.importLibrary("maps");
	        const { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary("marker",);
	        
	        /* Define the map view */
	        const map = new Map(document.getElementById("gpx_map"), {
	            restriction: {
	                latLngBounds: {{ MAP_BOUNDS | tojson }},
	                strictBounds: false,
	            },
	            zoom: 9,
	            center: { lat: {{ midlat }}, lng: {{ midlon }} },
	            mapId: "7499929d658a3166",
	        });
	        
	        /* Loop over Polylines */
	        {% for polyline in polylines %}
	        
		        /* Define our polyline */
		        const flightPath{{loop.index}} = new google.maps.Polyline({
		            path: {{ polyline['polyline'] }},
		            geodesic: true,
		            strokeColor: "{{ polyline['color'] }}",
		            strokeOpacity: 1.0,
		            strokeWeight: 4,
		        });
		
				/* We want a pop up info box for thr GPX route */
				google.maps.event.addListener(flightPath{{loop.index}}, 'mouseover', function(event) {
		            current_lat = event.latLng.lat();
		            current_lon = event.latLng.lng();
		            
		            // Create a new InfoWindow.
		            gpxInfoWindow{{loop.index}} = new google.maps.InfoWindow({
		                content: '{{ polyline['name'] | safe }}',
		                position: event.latLng,
		            });
		            
		            gpxInfoWindow{{loop.index}}.open(map);
				});
		
				/* and close the info box when they move elsewhere */
				google.maps.event.addListener(flightPath{{loop.index}}, 'mouseout', function() {
		            gpxInfoWindow{{loop.index}}.close();
				});
		
				/* Add the path to the map */
		        flightPath{{loop.index}}.setMap(map);
	        
	        {% endfor %}
	        
		}
	
		initGpxMap();
	
	</script>

{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                     Map of GPX Routes                                          -->
<!---------------------------------------------------------------------------------------------------->

{% if gpxes | count != 0 %}
	
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
	
				<h2 class="my-3">Map view of Gravel routes</h2>
				
				<!---------------------------------------------------------------------------------------------------->
				<!--                                      Insert Google Map                                         -->
				<!---------------------------------------------------------------------------------------------------->
				
				{% if GOOGLE_MAPS_API_KEY %}
					
					<!-- Live Maps -->
					<div id="gpx_map" style="height: 500px"></div>
					
					{% if warning: %}
						<h4 class="my-3">{{ warning }}</h4>
					{% endif %}
				
				{% else %}
				
					<!-- Maps have been disabled -->
					<img src="{{ url_for('static', filename='img/fake_map.jpg') }}">
				
				{% endif %}
				
				<!-- Break before next section -->
				<hr>
	
			</div>
		</div>
	</div>

{% endif %}


<!---------------------------------------------------------------------------------------------------->
<!--                                       List GPX Routes                                          -->
<!---------------------------------------------------------------------------------------------------->

<!--
	Jinja variables have very limited scope, eg they don't last beyond loop iterations. So you can't just
	create 'hidden' in the loop below and use it at the end. The fix is to add it to the namespace variables.
-->
{% set ns = namespace(hidden="") %}

<div class="container">
	
	<!-- Table of all the routes -->
	<div class="row">
		<div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
			
			<h2 class="mb-3">Gravel GPXes</h2>
			
			<table id="gpxTable" class="table table-striped table-bordered table-sm table-condensed"
			       data-page-length="25"
			       style="width: 100%">
			
				<!-- Header -->
				<thead>
                    <tr>
	                    {% if not mobile %}
                            <th scope="col">ID</th>
	                    {% endif %}
                        <th scope="col">Name</th>
                        <th scope="col">Length (km)</th>
                        <th scope="col">Ascent (m)</th>
	                    <th scope="col">Type</th>
	                    {% if not mobile %}
	                        <th scope="col">Uploaded by</th>
	                    {% endif %}
                    </tr>
                </thead>
		
				<tbody>
					{% for gpx in gpxes: %}
					
						<!--
							Criteria for being to see a route is:
								1. It's public
								2. You're Admin (can see all)
								3. You are the author of the route
						-->
						
						<!-- Tortuous logic: current_user.admin() doesn't exist until they log in -->
						{% if not current_user.is_authenticated and not gpx.public(): %}
					
							<!-- Skip this row -->
					
						{% elif gpx.public() or current_user.admin() or gpx.email == current_user.email: %}
							
							{% if gpx.id in missing_files: %}
								<tr class="table-danger">
							{% elif not gpx.public(): %}
								<!-- We have hidden rows for non public routes -->
								<tr class="table-warning">
								{% set ns.hidden = "NB Routes in yellow have not been made public yet by their owner and are only visible to Admins
				                                 and the owner. Only the owner can publish the route and make it public." %}
							{% else %}
								<tr>
							{% endif %}
							
							{% if not mobile %}
								<td scope="row">{{ gpx.id }}</td>
							{% endif %}
							<td scope="row"><a href="{{ url_for('gpx_details', gpx_id=gpx.id) }}">{{ gpx.name }}</a></td>
							<td scope="row">{{ gpx.length_km }}</td>
                            <td scope="row">{{ gpx.ascent_m }}</td>
							<td scope="row">{{ gpx.type }}</td>
							{% if not mobile %}
								<td scope="row">{{ get_user_name(gpx.email) }}</td>
							{% endif %}
					    </tr>
						{% endif %}
					{% endfor %}
				</tbody>
			
			</table>
			
			<!-- If we had hidden routes, we add a note here to explain what yellow means -->
			<p>{{ ns.hidden }}</p>
			
			
			<p>
				To add a GPX file, go to the GPX list page <a href="{{ url_for('gpx_list') }}"><strong>here.</strong></a>
			</p>
			
		</div>
	</div>
	
</div>

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-md-10 mx-auto">
		
			<!-- Break before footer -->
			<hr>
		
		</div>
	</div>
</div>


<!---------------------------------------------------------------------------------------------------->
<!--                               Activate jQuery on the Table                                     -->
<!---------------------------------------------------------------------------------------------------->

<script>
	
	$(document).ready( function () {
		$('#gpxTable').dataTable({
		
			/* Default table length */
			pageLength: 20,
			
			"autoWidth": false,
			
			/* "simple_numbers" => 'Previous' and 'Next' buttons, plus page numbers */
			"pagingType": "simple_numbers",
			
			"oLanguage": {
				"oPaginate": {
					"sFirst": "<<", // This is the link to the first page
					"sPrevious": "<", // This is the link to the previous page
					"sNext": ">", // This is the link to the next page
					"sLast": ">>" // This is the link to the last page
				}
			}
			
		})
	} );
	
</script>


{% endblock %}