{% extends "base.html" %}


{% block content %}


<!---------------------------------------------------------------------------------------------------->
<!--                                       Page Header                                              -->
<!---------------------------------------------------------------------------------------------------->

<header class="masthead" style="background-image: url('{{ url_for('static', filename='img/classifieds-bg.jpg')}}')">
	<div class="overlay"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<div class="page-heading">
					<h1>Classifieds</h1>
					<span class="subheading">This time next year, we'll be millionaires!</span>
				</div>
			</div>
		</div>
	</div>
</header>


<!---------------------------------------------------------------------------------------------------->
<!--                                 Show flash messages                                            -->
<!---------------------------------------------------------------------------------------------------->

{% with messages = get_flashed_messages() %}
	{% if messages %}
		{% for message in messages %}
			<div class="alert alert-warning text-center">
				{{ message }}
			</div>
		{% endfor %}
	{% endif %}
{% endwith %}


<!---------------------------------------------------------------------------------------------------->
<!--                                      Main Content                                              -->
<!---------------------------------------------------------------------------------------------------->

{% if not classifieds %}

	<!----------------------------------------------------------->
	<!--                   No Classifieds                      -->
	<!----------------------------------------------------------->

	<!-- Billy no mates -->
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<p>
					How sad, it looks like we don't have anything to show yet....
				</p>
				
			</div>
		</div>
	
		<!-- Add a classifieds post -->
		{% if current_user.is_authenticated %}
			{% if current_user.readwrite() %}
				<div class="row">
					<div class="col-lg-8 col-md-10 mx-auto">
						<a href="{{ url_for('add_buy') }}" class="btn btn-primary float-right ml-2" role="button">
			                  Buy
			            </a>
						<a href="{{ url_for('add_sell') }}" class="btn btn-primary float-right ml-2" role="button">
			                  Sell
			            </a>
					</div>
				</div>
			{% endif %}
		{% endif %}

		<!-- Separator before footer -->
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>
		
	</div>

{% else %}

	<!---------------------------------------------------------------------------------------------------->
	<!--                                          Blog Posts                                            -->
	<!---------------------------------------------------------------------------------------------------->

	{% for classified in classifieds %}

		<div class="container">
			
			<!-- 1st row of header: Title and Category -->
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<h2 class="float-left">
						{{ classified.buy_sell }}: {{ classified.title }}
							</h2>
					<h2 class="float-right">{{ classified.category }}</h2>
				</div>
			</div>
			
			<!-- 2nd row of header: Gravatar, username and price -->
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<img class="float-left" src="{{ classified.email | gravatar }}"
						 width="40" style="border-radius: 50%;"/>
					<h4 class="float-left mt-2"> &nbsp; {{ get_user_name(classified.email) }}</h4>
					<h2 class="float-right mt-2">Â£{{ classified.price }}</h2>
				</div>
			</div>
		
			<!-- 3rd row: Image -->
			{% if classified.images %}
			
				<div class="row mt-3">
					<div class="col-lg-8 col-md-10 mx-auto">
						<div id="carouselExampleIndicators" class="carousel slide" data-interval="false">
							
							<!-- slide selector -->
							<ol class="carousel-indicators">
								{% for image in classified.images %}
									{% if loop.index == 1 %}
										<li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index - 1 }}" class="active"></li>
									{% else %}
										<li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index - 1 }}"></li>
									{% endif %}
								{% endfor %}
							</ol>
							
							<!-- Images -->
							<div class="carousel-inner">
								{% for image in classified.images %}
								
									{% if loop.index == 1 %}
										<div class="carousel-item active">
											<img src="{{ url_for('static', filename=image) }}" class="d-block w-100"
											     style="width: 100%; border: 4px solid #000;">
										</div>
									{% else %}
										<div class="carousel-item">
											<img src="{{ url_for('static', filename=image) }}" class="d-block w-100"
											     style="width: 100%; border: 4px solid #000;">
										</div>
									{% endif %}
								
								{% endfor %}
							</div>
							
							<!-- Left and right buttons -->
							<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="sr-only">Previous</span>
							</a>
							<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="sr-only">Next</span>
							</a>
				
						</div>
					</div>
				</div>
			
			{% endif %}
			
			<!-- 4th row: Guts of the post -->
			<div class="row mt-3">
				<div class="col-lg-8 col-md-10 mx-auto">
					{{ classified.details | safe }}
				</div>
			</div>
			
		</div>

	{% endfor %}

	
	<div class="container">
		<!-- Break before footer -->
		<div class="row">
			<div class="col-lg-8 col-md-10 mx-auto">
				<hr>
			</div>
		</div>
	</div>


{% endif %}



{% endblock %}